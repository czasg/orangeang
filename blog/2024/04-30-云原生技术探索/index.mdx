---
title: äº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢
authors: [czasg]
tags: [æ’°å†™ä¸­,å¾…åˆ†ç±»]
slug: äº‘åŸç”ŸæŠ€æœ¯æ¢ç´¢
toc_max_heading_level: 5
---

import FullScreenImage from '@site/src/components/FullScreenImage';
import BrowserWindow from '@site/src/components/BrowserWindow';
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<!--package-->

å¦‚æœåœ¨10å¹´å‰ï¼Œæœ‰äººç»™ä½ åš å®¹å™¨ã€äº‘åŸç”Ÿï¼ŒServerlessçš„åˆ†äº«ï¼Œä½ è‚¯å®šä¼šä»¥ä¸ºè¿™ä¸ªäººæ˜¯ä¸ªå¤§å¿½æ‚ ã€‚ç‰¹åˆ«æ˜¯å¦‚æœä½ åœ¨å½“æ—¶å°±æœ‰äº†ä¸€å®šçš„çŸ¥è¯†ç§¯ç´¯ï¼Œä½ æ›´å¯èƒ½è§‰å¾—è¿™äº›æŠ€æœ¯ï¼Œéƒ½åªä¸è¿‡æ˜¯â€œæ–°ç“¶è£…æ—§é…’â€ï¼Œä¸å€¼å¾—è¿‡åº¦å…³æ³¨ã€‚

ä½†æŠ€æœ¯çš„æ¼”è¿›ï¼Œå¾€å¾€å°±æ˜¯ä» **â€œçœ‹ä¸åˆ° / çœ‹ä¸èµ·â€ => "çœ‹ä¸æ‡‚" => "è·Ÿä¸ä¸Š"**ã€‚

ä½†æ— è®ºç°é˜¶æ®µçš„æˆ‘ä»¬å¤„äºé‚£ç§çŠ¶æ€ï¼Œåœ¨å½“å‰å®¹å™¨åŒ–æ—¶ä»£ï¼ŒæŒæ¡å®¹å™¨å¼•æ“ã€å®¹å™¨ç¼–æ’ç®¡ç†å·¥å…·çš„ä½¿ç”¨ï¼Œäº†è§£å…¶åŸºç¡€æ¦‚å¿µä¸åŸç†ï¼Œè¿™éƒ½å°†æœ‰åŠ©äºæ—¥å¸¸å·¥ä½œçš„å¼€å±•ã€‚

<!--truncate-->

## 1.äº‘è®¡ç®—æ¼”è¿›å²

:::info äº‘è®¡ç®—

äº‘è®¡ç®—æ˜¯é€šè¿‡äº’è”ç½‘æä¾›è®¡ç®—èµ„æºä¸æœåŠ¡ï¼Œç”¨æˆ·æŒ‰éœ€è·å–ï¼Œæ— éœ€æ‹¥æœ‰ç¡¬ä»¶ï¼Œå®ç°çµæ´»ã€ç»æµé«˜æ•ˆçš„è®¡ç®—æ¨¡å¼ï¼Œè€Œæ— éœ€åœ¨æœ¬åœ°æ‹¥æœ‰å’Œç»´æŠ¤ç¡¬ä»¶å’Œè½¯ä»¶ã€‚

ç®€å•æ¥è¯´ï¼šäº‘è®¡ç®—æ˜¯ä¸€ç§æœåŠ¡æ¨¡å¼ï¼Œå®ƒé€šè¿‡äº’è”ç½‘å‡ºç§Ÿäº‘æœåŠ¡å™¨ã€‚

:::

:::info äº‘åŸç”Ÿ

CNCFï¼ˆCloud Native Computing Foundationï¼Œäº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼šï¼‰å¯¹äº‘åŸç”Ÿçš„å®šä¹‰ï¼šäº‘åŸç”ŸæŠ€æœ¯æ˜¯æœ‰åˆ©äºå„ç»„ç»‡åœ¨å…¬æœ‰äº‘ã€ç§æœ‰äº‘å’Œæ··åˆäº‘ç­‰æ–°å‹åŠ¨æ€ç¯å¢ƒä¸­ï¼Œæ„å»ºå’Œè¿è¡Œå¯å¼¹æ€§æ‰©å±•çš„åº”ç”¨æŠ€æœ¯ã€‚å…¶ä»£è¡¨æŠ€æœ¯åŒ…æ‹¬ï¼šå®¹å™¨ã€æœåŠ¡ç½‘æ ¼ã€å¾®æœåŠ¡ã€ä¸å¯å˜åŸºç¡€è®¾æ–½å’Œå£°æ˜å¼ API ç­‰ã€‚

ç®€å•æ¥è¯´ï¼šäº‘åŸç”Ÿæ˜¯ä¸€ç§è½¯ä»¶æŠ€æœ¯æ¶æ„ï¼Œåœ¨äº‘è®¡ç®—çš„åŸºç¡€ä¸Šï¼Œå®ç°äº†ï¼š

- åº”ç”¨å®¹å™¨åŒ–
- å®¹å™¨ç¼–æ’åŒ–ï¼ˆæ¨ªå‘æ‰©å®¹ã€æ»šåŠ¨å‡çº§ã€è´Ÿè½½å‡è¡¡ã€å®¹ç¾å¤‡ä»½ç­‰ï¼‰

:::



### 1.1.è™šæ‹ŸåŒ–æŠ€æœ¯è½åœ°

è™šæ‹ŸåŒ–æŠ€æœ¯æ˜¯ä¸€ç§èµ„æºç®¡ç†æŠ€æœ¯ï¼Œåœ¨å„ç§å®ä½“èµ„æºï¼ˆCPUã€å†…å­˜ã€ç½‘ç»œã€å­˜å‚¨ç­‰ï¼‰ä¹‹ä¸Šæ„å»ºä¸€ä¸ªé€»è¾‘å±‚ï¼Œä»è€Œæ‘†è„±ç‰©ç†é™åˆ¶çš„çº¦æŸï¼Œæé«˜ç‰©ç†èµ„æºçš„åˆ©ç”¨ç‡ã€‚

- 2001 å¹´ VMware å‘å¸ƒ VMware ESXã€‚å®ƒå¯ä»¥åœ¨åŒä¸€å°ç‰©ç†æœºä¸Šè¿è¡Œå¤šä¸ªè™šæ‹Ÿæœºã€‚è¿™æ„å‘³ç€è™šæ‹ŸåŒ–æŠ€æœ¯çœŸæ­£å¾—åˆ°äº†è½åœ°ï¼ŒæœåŠ¡å™¨çš„æ•°é‡å°†ä¸‹é™ï¼Œä¸ä¹‹å¯¹åº”çš„æ˜¯ï¼ŒæœåŠ¡å™¨èµ„æºå°†å¾—åˆ°æ›´åŠ å……åˆ†çš„åˆ©ç”¨ã€‚ <br/>
- 2006 å¹´ AWS é¦–åˆ›æŒ‰æ—¶è®¡è´¹çš„æ–¹å¼ç§Ÿå€ŸæœåŠ¡å™¨ï¼Œæ­å¼€äº†äº‘è®¡ç®—æ—¶ä»£å¸·å¹•ã€‚ <br/>
- 2008 å¹´ Alibaba å¼€å§‹ç­¹å¤‡é˜¿é‡Œäº‘ï¼Œäº‘è®¡ç®—é€æ¸æˆä¸ºè®¡ç®—æœºé¢†åŸŸæœ€ä»¤äººå…³æ³¨çš„è¯é¢˜ä¹‹ä¸€ã€‚ <br/>
- 2010 å¹´ openstack å‘å¸ƒç¬¬ä¸€ä¸ªå¼€æºç‰ˆæœ¬ï¼Œäº‘è®¡ç®—æ­£å¼è¿›å…¥å¼€æºæ—¶ä»£ã€‚ <br/>

å°ç»“ï¼šè™šæ‹ŸåŒ–æŠ€æœ¯ æé«˜äº† ç‰©ç†èµ„æºçš„åˆ©ç”¨ç‡ã€‚æå¤§çš„æå‡äº†ç¡¬ä»¶ä»·å€¼ä¸Šé™ã€‚

### 1.2.å®¹å™¨åŒ–æŠ€æœ¯è½åœ°

å®¹å™¨åŒ–æŠ€æœ¯åŒæ ·ä¹Ÿæ˜¯ä¸€ç§èµ„æºç®¡ç†æŠ€æœ¯ï¼Œå®ƒæ˜¯åœ¨å¤ç”¨ç³»ç»Ÿå†…æ ¸çš„åŸºç¡€ä¹‹ä¸Šï¼Œå¯¹å®ä½“èµ„æºï¼ˆç½‘ç»œã€è¿›ç¨‹ã€å­˜å‚¨ç­‰ï¼‰è¿›ä¸€æ­¥çš„æ„å»ºä¸€ä¸ªé€»è¾‘å±‚ã€‚å› æ­¤ç›¸æ¯”å¯¹è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œå®¹å™¨åŒ–æŠ€æœ¯éš”ç¦»æ˜¯ä¸å½»åº•çš„ï¼Œä½†æ›´è½»é‡çº§ã€‚

- 2013 å¹´ docker å‘å¸ƒã€‚å®¹å™¨åœ¨å¤šæ•°é¢†åŸŸé€æ­¥æ›¿ä»£ VMï¼Œäº‘è®¡ç®—è¿›å…¥å®¹å™¨æ—¶ä»£ã€‚ <br/>
- 2018 å¹´ kubernetes åŸºæœ¬å…¨é¢èµ¢å¾—å®¹å™¨ç¼–æ’å¸‚åœºçš„èƒœåˆ©ï¼Œäº‘è®¡ç®—è¿›å…¥ K8S æ—¶ä»£ã€‚ <br/>

å°ç»“ï¼šå®¹å™¨åŒ–æŠ€æœ¯ å»ºç«‹åœ¨ è™šæ‹ŸåŒ–æŠ€æœ¯ä¼˜åŠ¿ä¹‹ä¸Šï¼Œä¸ä»…å¤§å¹…æé«˜äº†èµ„æºçš„åˆ©ç”¨ç‡ï¼Œè¿˜æä¾›æ›´è½»é‡çº§çš„ç®¡ç†æ–¹å¼ã€‚


## 2.äº‘åŸç”Ÿä»£è¡¨æŠ€æœ¯

### 2.1.å®¹å™¨æŠ€æœ¯ï¼ˆdockerï¼‰

#### 2.1.1.ä»€ä¹ˆåœºæ™¯ä¸‹å¯ä»¥ä½¿ç”¨å®¹å™¨æŠ€æœ¯?

```
æŸå…¬å¸...

ç ”å‘ï¼šæœåŠ¡æ˜¯å¦å¯ä»¥ç›´æ¥éƒ¨ç½²åœ¨å†…éƒ¨çš„è™šæ‹Ÿæœºä¸Š
ç»„é•¿ï¼šå¯ä»¥ï¼Œä½†ä¸å»ºè®®ï¼Œä½ ä»¬è‡ªå·±éƒ¨ç½²çš„æœåŠ¡ï¼Œæ²¡æœ‰è¿ç»´ä¿éšœï¼Œå®¹æ˜“èƒŒé”…
ç ”å‘ï¼šå¯æ˜¯æˆ‘ä»¬ä¹‹å‰å…¬å¸éƒ½æ˜¯éƒ¨ç½²åœ¨è‡ªå·±çš„è™šæ‹Ÿæœºä¸Š
ç»„é•¿ï¼šä½ å¯ä»¥æŠŠæœåŠ¡æ„å»ºé•œåƒï¼Œç„¶åç”¨å®¹å™¨å»è·‘
ç ”å‘ï¼šæ²¡å¿…è¦å•Šï¼Œæˆ‘ç¯å¢ƒéƒ½é…å¥½äº†ï¼Œç›´æ¥è·‘ä¸æ˜¯ä¸€æ ·çš„ï¼Œæ€§èƒ½è¿˜æ›´å¥½...
ç»„é•¿ï¼šé‚£å¦‚æœè¿™å°è™šæ‹Ÿæœºæœ‰é—®é¢˜ï¼Œä½ èƒ½ç¡®ä¿æœåŠ¡å¿«é€Ÿæ¢å¤å—
ç ”å‘ï¼šå¯ä»¥ï¼Œç¨‹åºä¾èµ–éƒ½å·²ç»æ‰“åŒ…å¥½äº†ï¼ˆjar / venv / static / binï¼‰ï¼Œå¯ä»¥å¿«é€Ÿé‡æ–°éƒ¨ç½²æ¢å¤
ç»„é•¿ï¼šojbk

... ...

æŸå¤©ï¼Œè™šæ‹Ÿæœºè£‚å¼€äº†ï¼Œç ”å‘è·‘è·¯ï¼Œè¿ç»´æ¥å‘...
è¿ç»´ï¼šå®Œäº†ï¼Œè¿™å¼æ¯› jar æ€ä¹ˆè·‘ä¸èµ·æ¥ï¼Œä¸€å †é£˜çº¢é¢...
è¿ç»´ï¼šå®Œäº†ï¼Œè¿™å¼æ¯› php æ˜¯è·‘èµ·æ¥äº†è¿˜æ˜¯æ²¡è·‘èµ·æ¥...

... ...
```

ä¸Šè¿°åœºæ™¯ï¼Œç²—çœ‹æ˜¯ä¸€ä¸ªæŠ€æœ¯å£å’é—®é¢˜ã€‚æœ¬è´¨åº”è¯¥è¿˜æ˜¯ä¸€ä¸ªç®¡ç†é—®é¢˜ï¼ˆäº¤æ¥æ–‡æ¡£æ²¡æœ‰å†™æ¸…æ¥šï¼Œéƒ¨ç½²è¯´æ˜æ²¡æœ‰ä»‹ç»æ¸…æ¥šç­‰...ï¼‰ã€‚ <br/>
ä½†æ˜¯ï¼Œè¿™ä¸ªæ¡ˆåˆ—åˆéå¸¸ç»å…¸ï¼Œå› ä¸ºæŠ€æœ¯å£å’å¯¼è‡´çš„é¡¹ç›®ç®¡ç†å¤æ‚åº¦ä¸Šå‡ï¼Œæ˜¯éå¸¸å¸¸è§çš„ã€‚ <br/>
ç‰¹åˆ«æ˜¯å¯¹ä¸€äº›äº¤ä»˜æºç çš„é¡¹ç›®ï¼Œè¿™ç§é¡¹ç›®å¾€å¾€é«˜åº¦ä¾èµ–ç¯å¢ƒå‡†å¤‡... <br/>

å¦‚æœæœ‰ä¸€ç§æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å®šä¹‰ä¸€ç§é€šç”¨çš„äº¤ä»˜äº§ç‰©ï¼Œæ¶ˆé™¤ç ”å‘ã€æµ‹è¯•ã€è¿ç»´ã€äº§å“ä¹‹é—´çš„å¼ºæŠ€æœ¯å£å’ï¼Œå¹¶åœ¨æ•´ä¸ªé¡¹ç›®ç”Ÿå‘½å‘¨æœŸå†…è¾¾æˆä¸€ç§é€šç”¨çš„â€œè¯­è¨€â€ã€‚é‚£è¿™ä¸ªæŠ€æœ¯ï¼Œç®€ç›´æ³°è£¤è¾£ã€‚

è€Œ dockerï¼Œå°±æ˜¯è¿™ä¹ˆä¸€é—¨æŠ€æœ¯ã€‚ <br/>
å®ƒåˆ›æ–°æ€§çš„å¼•å…¥äº†é•œåƒæ¦‚å¿µï¼Œé‡æ–°å®šä¹‰äº†äº¤ä»˜äº§ç‰©ï¼Œè®©ä¸åŒçš„æœåŠ¡ä¹‹é—´ï¼Œå¯ä»¥ä»¥è¿‘ä¹ç›¸ä¼¼çš„æ–¹å¼è¿›è¡Œç»´æŠ¤ã€‚ <br/>
ä¹Ÿæ­£æ˜¯å› ä¸ºé•œåƒçš„å¼•å…¥ï¼Œå½»åº•æ€èµ·äº†å®¹å™¨åŒ–çš„çƒ­æ½®~ <br/>

ç­”æ¡ˆï¼šé™¤äº†ä¸èƒ½ç”¨ä½¿ç”¨å®¹å™¨çš„åœºæ™¯ï¼Œå¦åˆ™éƒ½æ¨èä½¿ç”¨å®¹å™¨æŠ€æœ¯~



#### 2.1.2.ä¸€ä¸ªç®€å•çš„å®¹å™¨åœºæ™¯

åœºæ™¯ï¼šå‰ç«¯ç¼–è¯‘åéœ€è¦å¯¹å¤–å‘å¸ƒ

```python title="1-ç¼–è¯‘é•œåƒ"
### é•œåƒæ‹‰å–
> docker pull nginx:latest

### é•œåƒæ¨¡æ¿
> vim Dockerfile
1. FROM nginx:latest
2.
3. COPY ./dist/ /usr/share/nginx/html/
4. EXPOSE 80

### ç¼–è¯‘é•œåƒ
> docker build -t harbor.avlyun.org/developer-center/web-fe:latest .
```

```python title="2-æ¨é€é•œåƒ"
### ç™»å½•é•œåƒä»“åº“
> docker login harbor.avlyun.org

### æ¨é€é•œåƒ
> docker push harbor.avlyun.org/developer-center/web-fe:latest
```

```python title="3-è¿è¡Œå®¹å™¨"
### ç™»å½•è¿œç¨‹æœåŠ¡
> ssh xx.xx.xx.xx

### æ‹‰å–é•œåƒ
> docker pull harbor.avlyun.org/developer-center/web-fe:latest

### å¯åŠ¨æœåŠ¡
> docker run -itd --name web-fe -p 80:80 harbor.avlyun.org/developer-center/web-fe:latest
```

#### 2.1.3.å®¹å™¨æ ¸å¿ƒæŠ€æœ¯
- cgroupsï¼šå¯ä»¥æ§åˆ¶è¿›ç¨‹èµ„æºçš„ä½¿ç”¨ã€‚å¦‚ï¼šCPUã€å†…å­˜ ç­‰ã€‚
- namespaceï¼šå¯ä»¥æ§åˆ¶è¿›ç¨‹èµ„æºçš„éš”ç¦»ã€‚å¦‚ï¼šç½‘ç»œã€å­˜å‚¨ ç­‰ã€‚
- unionfsï¼šå¯ä»¥å°†å¤šä¸ªç›®å½•è”åˆæŒ‚è½½åˆ°ä¸€ä¸ªç»Ÿä¸€çš„ç›®å½•ã€‚ï¼ˆå¯ä»¥ç®€å•è®¤ä¸ºæ˜¯ä¸€ç§åªè¯»çš„è½¯é“¾æ¥ï¼‰

#### 2.1.4.dockeræ ¸å¿ƒæ¦‚å¿µ
- é•œåƒ
- ç½‘ç»œ
- å­˜å‚¨å·

##### 2.1.4.1.é•œåƒ

é•œåƒæ˜¯æ„å»ºå’Œè¿è¡Œå®¹å™¨çš„åŸºç¡€ã€‚æˆ‘ä»¬å¯ä»¥æŠŠé•œåƒç†è§£ä¸ºä¸€ä¸ªåªè¯»çš„æ¨¡æ¿ï¼Œæˆ–è€…æ˜¯å‹ç¼©åŒ…ï¼Œå®ƒåŒ…å«äº†è¿è¡Œä¸€ä¸ªåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰å†…å®¹ï¼š

- åº”ç”¨ç¨‹åºï¼ˆæºç /ç¼–è¯‘äº§ç‰©ï¼‰
- è¿è¡Œæ—¶ç¯å¢ƒ
- ç³»ç»Ÿå·¥å…·
- ä¸‰æ–¹åº“ä¾èµ–
- é…ç½®å‚æ•°
- ... ...

æˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠé•œåƒç†è§£ä¸ºä¸€ä¸ªç‹¬ç«‹ä¸”å®Œæ•´çš„åº”ç”¨ç¨‹åºåŒ…ã€‚

æ€è€ƒï¼šé•œåƒå’Œä¹‹å‰æ‰€æåˆ°çš„äº¤ä»˜äº§ç‰©æœ‰ä½•åŒºåˆ«ã€‚

é•œåƒç”±ä¸€ç³»åˆ—çš„å±‚ç»„æˆï¼Œæ¯ä¸ªå±‚éƒ½ä»£è¡¨ç€é•œåƒçš„ä¸€éƒ¨åˆ†ã€‚è¿™äº›å±‚åœ¨æ„å»ºé•œåƒæ—¶æŒ‰ç…§é¡ºåºæ·»åŠ ï¼Œå¹¶ä¸”éƒ½æ˜¯åªè¯»çš„ï¼Œå› æ­¤åœ¨æ„å»ºç›¸åŒå±‚æ—¶å¯ä»¥å¤ç”¨ï¼Œä»è€ŒèŠ‚çœå­˜å‚¨ç©ºé—´ã€‚

<FullScreenImage src={require("./image-layer.jpg").default} />

è‡ªå·±æ„å»ºä¸€ä¸ªé•œåƒ

```dockerfile
FROM ubuntu:15.04

mkdir /workplace

echo -n > /workplace/README.md
```

<FullScreenImage src={require("./image-layer-2.png").default} />

é•œåƒæœ€ç»ˆä¼šé€šè¿‡ç±»ä¼¼ä¸€ç§å †ç§¯æœ¨çš„æ–¹å¼å‘ˆç°å‡ºæ¥ã€‚ä»æŠ€æœ¯è§’åº¦æ¥è®²ï¼Œè¿™æ˜¯é€šè¿‡è”åˆæ–‡ä»¶ç³»ç»Ÿå®ç°çš„ã€‚

<FullScreenImage src={require("./image-layer-3.png").default} />


##### 2.1.4.2.ç½‘ç»œ

åœ¨ docker ä¸­ï¼Œç½‘ç»œæ˜¯ä¸€ç§ç”¨äºå®¹å™¨é—´é€šä¿¡çš„æœºåˆ¶ã€‚åœ¨åŒä¸€ä¸ªè™šæ‹Ÿç½‘ç»œä¸‹ï¼Œä¸åŒå®¹å™¨ä¹‹é—´æ˜¯å¯ä»¥ç›¸äº’è®¿é—®çš„ã€‚

<FullScreenImage src={require("./network.png").default} />

ä¸ºäº†ç¡®ä¿å®¹å™¨æ‰€å¤„ç½‘ç»œç¯å¢ƒéš”ç¦»æ€§ï¼Œå¯ä»¥é€šè¿‡è‡ªå®šä¹‰è™šæ‹Ÿç½‘ç»œæ¥å®ç°ã€‚

```python
# åˆ›å»ºç½‘ç»œnetwork1å’Œnetwork2
docker network create network1
docker network create network2

# åœ¨network1ä¸­åˆ›å»ºå®¹å™¨container1
docker run -d --name container1 --network network1 your_image

# åœ¨network2ä¸­åˆ›å»ºå®¹å™¨container2
docker run -d --name container2 --network network2 your_image
```

<FullScreenImage src={require("./network-1.png").default} />

ä¸ºäº†è¿›ä¸€æ­¥çš„å®ç°ç½‘ç»œèµ„æºå…±äº«ï¼Œå¯ä»¥é€šè¿‡ç½‘ç»œè¿æ¥çš„æ–¹å¼ï¼Œå°†å¤šå®¹å™¨è¿æ¥åˆ°æŸä¸€ä¸ªå®¹å™¨ï¼Œä»è€Œå¤ç”¨æŒ‡å®šå®¹å™¨çš„ç½‘ç»œï¼ˆIPï¼‰èµ„æºã€‚

```python
# åˆ›å»ºç½‘ç»œnetwork1
docker network create network1

# åœ¨network1ä¸­åˆ›å»ºå®¹å™¨container1
docker run -d --name container1 --network network1 your_image

# åœ¨network1ä¸­åˆ›å»ºå®¹å™¨container2ã€container3ï¼Œå¹¶è¿æ¥åˆ°container1
docker run -d --name container2 --network=container:container1 your_image
docker run -d --name container3 --network=container:container1 your_image
```

<FullScreenImage src={require("./network-2.png").default} />

##### 2.1.4.3.å­˜å‚¨å·

åœ¨ docker ä¸­ï¼Œå­˜å‚¨å·æ˜¯ä¸€ç§ç‰¹æ®Šçš„æ–‡ä»¶ç›®å½•æˆ–è€…æ–‡ä»¶ï¼Œç”¨äºåœ¨å®¹å™¨å’Œå®¿ä¸»æœºä¹‹é—´å®ç°æŒä¹…åŒ–å­˜å‚¨æ•°æ®ã€‚

å’Œé•œåƒå±‚çš„åªè¯»å±‚ä¸åŒçš„æ˜¯ï¼Œå­˜å‚¨å·æ‹¥æœ‰ï¼š

- æŒä¹…åŒ–çš„
- å…±äº«çš„
- ç‹¬ç«‹äºå®¹å™¨ç”Ÿå‘½å‘¨æœŸçš„

```
# -v
docker run -v /host/path:/container/path my_image

# --mount
docker run --mount type=bind,source=/host/path,target=/container/path my_image
```

### 2.2.å®¹å™¨ç¼–æ’æŠ€æœ¯

å®¹å™¨ç¼–æ’æŠ€æœ¯æœ¬è´¨å°±æ˜¯ç®¡ç†å®¹å™¨çš„æŠ€æœ¯ã€‚

ä¸ºä»€ä¹ˆéœ€è¦ä½¿ç”¨å®¹å™¨ç¼–æ’æŠ€æœ¯ï¼Œå®¹å™¨ç¼–æ’å’Œå®¹å™¨ä¹‹é—´çš„å…³ç³»ï¼Œå°±ç±»ä¼¼ è™šæ‹Ÿæœº å’Œ openstack ä¹‹é—´çš„å…³ç³»ï¼Œå¯¹äºå¤§å‹å®¹å™¨é›†ç¾¤ï¼Œéœ€è¦æœ‰ä¾¿æ·çš„å·¥å…·æ¥ç®¡ç†ã€‚

#### 2.2.1.k8sé›†ç¾¤æ¶æ„
k8s å°±æ˜¯ç›®å‰å¸‚é¢ä¸Šæœ€æˆåŠŸçš„å®¹å™¨ç¼–æ’å®ç°æ ‡å‡†ã€‚

å®ƒæ˜¯ç»å…¸çš„ä¸»ä»æ¶æ„ï¼Œåˆ†åˆ«æ˜¯ï¼šcontaol-plane å’Œ nodeã€‚

|å½’å±|æœåŠ¡|è¯´æ˜|
|---|---|---|
|control-plane|kube-api-server|k8s ç½‘å…³æœåŠ¡ï¼Œç”¨äºæ¥æ”¶æ‰€æœ‰ k8s è¯·æ±‚å¹¶è¿›è¡Œå¤„ç†|
|control-plane|kube-controller-manager|k8s æ§åˆ¶å™¨ï¼Œè´Ÿè´£ç›‘æ§ç³»ç»ŸçŠ¶æ€ä¸å˜åŒ–ï¼Œç¡®ä¿ç›®æ ‡çŠ¶æ€ç¬¦åˆæœŸæœ›çŠ¶æ€|
|control-plane|kube-scheduler|k8s è°ƒåº¦å™¨ï¼Œç»Ÿç­¹æ‰€æœ‰èŠ‚ç‚¹èµ„æºï¼Œè´Ÿè´£å’ŒèŠ‚ç‚¹äº¤äº’ï¼Œå¹¶åŸºäºä¸€å®šçš„è§„åˆ™ï¼ˆäº²å’Œæ€§ã€åäº²å’Œæ€§ï¼‰è¿›è¡Œèµ„æºè°ƒåº¦|
|control-plane|etcd|åˆ†å¸ƒå¼é”®å€¼å¯¹å­˜å‚¨ç³»ç»Ÿ|
|node|kubectl|èŠ‚ç‚¹ä¸Šçš„ä»£ç†æœåŠ¡ï¼Œè´Ÿè´£è¯¥èŠ‚ç‚¹çš„è¿è¡ŒçŠ¶æ€ã€å®¹å™¨ç®¡ç†ç­‰|
|node|kube-proxy|ç»´æŠ¤è¯¥èŠ‚ç‚¹ä¸Šçš„ç½‘ç»œè§„åˆ™ï¼Œä»¥ç¡®ä¿æœåŠ¡èƒ½å¤Ÿè¢«æ­£ç¡®å‘ç°|
|node|container-runtime|å®¹å™¨å¼•æ“ï¼Œè´Ÿè´£å®¹å™¨ç®¡ç†ï¼ŒåŒ…æ‹¬ï¼šåˆ›å»ºã€åˆ é™¤ç­‰|
|node|pod|k8s é›†ç¾¤ä¸­æœ€å°çš„å¯éƒ¨ç½²å•å…ƒã€‚ä¹Ÿæ˜¯é›†ç¾¤ä¸­å•æœåŠ¡çš„é«˜å±‚æŠ½è±¡|

æˆ‘ä»¬å¯ä»¥é€šè¿‡ç†Ÿæ‚‰ k8s çš„äº¤äº’æµç¨‹æ¥ç†Ÿæ‚‰ k8s æ¶æ„ã€‚ä¸‹é¢æ¼”ç¤ºä¸€æ¬¡å®Œæ•´çš„ `kubectl apply -f deploy.yaml` æ‰§è¡Œæµç¨‹ã€‚

<FullScreenImage src={require("./k8s.png").default} />


#### 3.2.2.podè¯¦è§£

å¦‚æœ k8s æ˜¯ä»¥ docker ä½œä¸ºå®¹å™¨å¼•æ“ï¼Œé‚£ä¹ˆæˆ‘ä»¬å®Œå…¨å¯ä»¥åœ¨æœ¬åœ°é€šè¿‡ docker æ¨¡æ‹Ÿå‡º pod çš„è¡Œä¸ºã€‚

<BrowserWindow>
    <Tabs>
        <TabItem value="pod" label="Pod" default>

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
```

        </TabItem>
        <TabItem value="docker-compose" label="DockerCompose">

```yaml
version: '3'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
```

        </TabItem>
    </Tabs>
</BrowserWindow>

å¯¹äºç®€å•åœºæ™¯ä¸‹çš„å•å®¹å™¨ Pod æ¥è¯´ï¼Œk8s å’Œ docker éƒ¨ç½²çš„æœåŠ¡å‡ ä¹æ²¡æœ‰ä»»ä½•åŒºåˆ«ã€‚

ä½†æ˜¯ï¼Œåœ¨å¤šå®¹å™¨åœºæ™¯ä¸‹ï¼ŒPod å¯¹å¤–è¡¨ç°å‡ºæ¥çš„æ›´åƒæ˜¯ä¸€ä¸ªæ•´ä½“ï¼Œå› ä¸ºä»–ä»¬å¯¹å¤–åªæœ‰ä¸€ä¸ª IP ~

<BrowserWindow>
    <Tabs>
        <TabItem value="pod-2" label="Pod" default>

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
  - name: server
    image: server:latest
    ports:
    - containerPort: 8080
```

        </TabItem>
        <TabItem value="docker-compose-2" label="DockerCompose">

```yaml
version: '3'
services:
  nginx:
    image: nginx:latest
    ports:
      - "80:80"
  server:
    image: server:latest
    ports:
      - "8080:8080"
```

        </TabItem>
        <TabItem value="cmd" label="CMD">

```yaml
docker create network pod

docker run -d --name pause --network=pod pause:latest

docker run -d --name nginx --network=container:pause nginx:latest
docker run -d --name server --network=container:pause server:latest
```

        </TabItem>
    </Tabs>
</BrowserWindow>

å¯¹äºè¿™ç§åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å®¹å™¨è¿æ¥æ¥å®ç°ï¼Œä½†é—®é¢˜æ˜¯ï¼Œä»¥è°ä¸ºæ ¹å®¹å™¨ä½œä¸ºè¢«å…¶ä»–å®¹å™¨è¿æ¥çš„å¯¹è±¡å‘¢ï¼Ÿ

PSï¼šæ ¹å®¹å™¨çš„ç‰¹ç‚¹ï¼šç¨³å®š

Pod è¯¦è§£

<FullScreenImage src={require("./k8s-2.png").default} />

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx-pod
spec:
  initContainers:  # åˆå§‹åŒ–å®¹å™¨åˆ—è¡¨
  - name: init-container
    image: busybox
    command: ['sh', '-c', 'echo Initializing... && sleep 5']  # æ‰§è¡Œåˆå§‹åŒ–æ“ä½œï¼Œè¾“å‡ºæ¶ˆæ¯å¹¶ä¼‘çœ 5ç§’é’Ÿ
  containers:  # ä¸»å®¹å™¨åˆ—è¡¨
  - name: nginx-container
    image: nginx
    lifecycle:  # å®šä¹‰å®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸé’©å­
      postStart:
        exec:
          command: ["/bin/sh", "-c", "echo Container started."]  # åœ¨å®¹å™¨å¯åŠ¨åæ‰§è¡Œçš„å‘½ä»¤
      preStop:
        exec:
          command: ["/bin/sh", "-c", "echo Container stopping..."]  # åœ¨å®¹å™¨åœæ­¢å‰æ‰§è¡Œçš„å‘½ä»¤
    readinessProbe:  # å°±ç»ªæ€§æ£€æŸ¥
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 5  # å®¹å™¨å¯åŠ¨åç­‰å¾…5ç§’å†è¿›è¡Œç¬¬ä¸€æ¬¡æ£€æŸ¥
      periodSeconds: 5  # é—´éš”5ç§’è¿›è¡Œä¸€æ¬¡æ£€æŸ¥
    livenessProbe:  # å­˜æ´»æ€§æ£€æŸ¥
      httpGet:
        path: /
        port: 80
      initialDelaySeconds: 10  # å®¹å™¨å¯åŠ¨åç­‰å¾…10ç§’å†è¿›è¡Œç¬¬ä¸€æ¬¡æ£€æŸ¥
      periodSeconds: 5  # é—´éš”5ç§’è¿›è¡Œä¸€æ¬¡æ£€æŸ¥
    volumeMounts:  # å®¹å™¨çš„æŒ‚è½½ç‚¹
    - name: shared-data
      mountPath: /usr/share/nginx/html  # å°† emptyDir å·æŒ‚è½½åˆ°å®¹å™¨çš„ /usr/share/nginx/html è·¯å¾„ï¼Œå®ç°æ•°æ®å…±äº«
  volumes:  # å·åˆ—è¡¨
  - name: shared-data
    emptyDir: {}  # ç©ºç›®å½•å·ï¼Œç”¨äºåœ¨ init-container å’Œä¸»å®¹å™¨ä¹‹é—´å…±äº«æ•°æ®
  restartPolicy: Always  # å®¹å™¨çš„é‡å¯ç­–ç•¥ï¼Œå§‹ç»ˆé‡å¯
```

#### 3.2.3.å¸¸ç”¨èµ„æºå¯¹è±¡ä»‹ç»
åœ¨ k8s é›†ç¾¤ä¸­ï¼Œä¸€èˆ¬ä¸ç›´æ¥ä½¿ç”¨ podã€‚å› ä¸º pod çš„ç”Ÿå‘½å‘¨æœŸè¢«è§†ä¸ºçŸ­æš‚çš„~

ä¸ºäº†æ›´å¥½çš„å»ç®¡ç†é›†ç¾¤ä¸­çš„ pod åº”ç”¨ï¼Œk8s é›†ç¾¤å¼•å…¥äº†å…¶ä»–çš„èµ„æºå¯¹è±¡ã€‚

|èµ„æºå¯¹è±¡|è¯´æ˜|å…¶ä»–|
|---|---|---|
|Deployment||
|Service|ä¸€ç»„æœåŠ¡çš„æŠ½è±¡|dns|
|Ingress|è·¯ç”±è§„åˆ™é›†ï¼Œç”¨äºæ§åˆ¶é›†ç¾¤å¤–éƒ¨æµé‡å¯¼å…¥|nginx|
|ConfigMap|é…ç½®ä¸­å¿ƒ||

<FullScreenImage src={require("./k8s-3.png").default} />

##### 3.2.3.1.configmap
configmap æ˜¯é”®å€¼å¯¹é…ç½®ï¼Œå¯ä»¥ä»¥ç¯å¢ƒå˜é‡æˆ–è€…æ–‡ä»¶çš„å½¢å¼æ³¨å…¥è¿› podã€‚

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: nginx
data:
  LOG_LEVEL: debug
  LOG_FORMAT: json
  NGINX_CONFIG_FILE: |-
    server {
        listen       80;
        server_name  localhost;
        location / {
            root   /usr/share/nginx/html;
            index  index.html index.htm;
        }
        error_page   500 502 503 504  /50x.html;
        location = /50x.html {
            root   /usr/share/nginx/html;
        }
    }
---
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
    envFrom: # æŒ‡å®šç¯å¢ƒå˜é‡æ¥æºäºconfigMap
    - configMapRef:
        name: nginx
    env: # ç›´æ¥åœ¨podä¸­æŒ‡å®šéœ€è¦å“ªäº›ç¯å¢ƒå˜é‡ï¼Œæ­¤ä¼˜å…ˆçº§æœ€é«˜
    - name: "LOG_LEVEL"
        value: "error"
    - name: "LOG_FORMAT"
        value: "text"
    volumeMounts: # é€šè¿‡æ–‡ä»¶çš„å½¢å¼æ³¨å…¥pod
    - mountPath: /etc/nginx/conf.d/
      name: nginx-conf-file
  volumes:
  - configMap: # æŒ‡å®šå­˜å‚¨å·ç±»å‹ä¸ºconfigMap
      defaultMode: 420
      items:
      - key: NGINX_CONFIG_FILE # ä»…å–å‡ºå…¶ä¸­æŸä¸ªkey
        path: default.conf
      name: nginx-conf-file
```

##### 3.2.3.2.ingress

```yaml
apiVersion: extensions/v1beta1
kind: Ingress
metadata:
  name: nginx
spec:
  rules:
    - host: nginx.hsk8s-dev.avlyun.org
      http:
        paths:
          - path: /download
            backend:
              serviceName: nginx
              servicePort: 80
          - path: /api/v1
            backend:
              serviceName: server-v1
              servicePort: 80
          - path: /api/v2
            backend:
              serviceName: server-v2
              servicePort: 80
```

##### 3.2.3.3.service
service æ˜¯ä¸€ç»„æœåŠ¡çš„æŠ½è±¡ï¼Œå¯ç”¨äº DNS è§£æï¼Œå…¶è§£æçš„ç»“æœï¼Œæ˜¯å¯¹åº” Pod çš„ IP é›†åˆã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥æŠŠ service å½“åšä¸€ä¸ªåˆæ³•çš„åŸŸåæ¥ä½¿ç”¨ã€‚ä¸‹é¢é€šè¿‡æ‰§è¡Œ `curl nginx.fos-2-dev` æ¥å±•ç¤º service çš„é­…åŠ›~

<FullScreenImage src={require("./service.png").default} />

```yaml
apiVersion: v1
kind: Service
metadata:
  name: nginx
spec:
  ports: # å®šä¹‰ä¸€ç»„æœåŠ¡ä¸­çš„ç«¯å£è½¬å‘
  - name: nginx
    port: 80
    protocol: TCP
    targetPort: 80
  selector: # å®šä¹‰ä¸€ç»„æœåŠ¡ï¼ˆpodï¼‰æ ‡ç­¾
    app: nginx
  type: ClusterIP
```

é—®é¢˜ï¼šåœ¨ k8s é›†ç¾¤ä¸­ï¼Œåˆ°åº•åº”è¯¥å¦‚ä½•è®¿é—®å…¶ä»–æœåŠ¡ï¼Ÿ

ç­”æ¡ˆï¼šåº”è¯¥é€šè¿‡ service.namespace æ¥è®¿é—®ï¼Œç›´æ¥ç«¯åˆ°ç«¯çš„è·‘æµé‡ï¼Œè€Œä¸ç”¨èµ° ingress è½¬å‘ã€‚

##### 3.2.3.1.deployment

<BrowserWindow>
    <Tabs>
        <TabItem value="pod-3" label="Pod" default>

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: nginx
spec:
  containers:
  - name: nginx
    image: nginx:latest
    ports:
    - containerPort: 80
```

        </TabItem>
        <TabItem value="deployment-rollingUpdate" label="Deployment/RollingUpdate">

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 3  # å‰¯æœ¬æ•°ä¸º 3
  selector:
    matchLabels:
      app: nginx
  strategy:
    rollingUpdate:
      maxSurge: 50%  # å…è®¸çš„æœ€å¤§è¶…å‡ºå‰¯æœ¬æ•°ï¼Œæ”¯æŒæ•´æ•°ï¼Œä¹Ÿæ”¯æŒç™¾åˆ†æ¯”
      maxUnavailable: 1  # å…è®¸çš„æœ€å¤§ä¸å¯ç”¨å‰¯æœ¬æ•°ï¼Œæ”¯æŒæ•´æ•°ï¼Œä¹Ÿæ”¯æŒç™¾åˆ†æ¯”
    type: RollingUpdate  # ä½¿ç”¨æ»šåŠ¨å‡çº§ç­–ç•¥
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest  # ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Nginx é•œåƒ
        ports:
        - containerPort: 80  # å®¹å™¨ç›‘å¬ç«¯å£ 80
```

        </TabItem>
        <TabItem value="deployment-recreate" label="Deployment/Recreate">

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
spec:
  replicas: 3  # å‰¯æœ¬æ•°ä¸º 3
  selector:
    matchLabels:
      app: nginx
  strategy:
    type: Recreate # ä½¿ç”¨é‡å»ºå‡çº§ç­–ç•¥
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
      - name: nginx
        image: nginx:latest  # ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬çš„ Nginx é•œåƒ
        ports:
        - containerPort: 80  # å®¹å™¨ç›‘å¬ç«¯å£ 80
```

        </TabItem>
    </Tabs>
</BrowserWindow>


## 4.ç­”ç–‘
... ...







<br/>

:::info ğŸ‘‡ğŸ‘‡ğŸ‘‡
**æœ¬æ–‡ä½œè€…:** æ©™å­æ˜‚ <br/>
**ç‰ˆæƒå£°æ˜:** è½¬è½½è¯·æ³¨æ˜å‡ºå¤„å“¦~ğŸ‘®â€ğŸ‘®â€ğŸ‘®â€
:::
