<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>橙子昂的小站 Blog</title>
        <link>https://czasg.github.io/orange-ang/blog</link>
        <description>橙子昂的小站 Blog</description>
        <lastBuildDate>Mon, 20 Jan 2025 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>zh-Hans</language>
        <item>
            <title><![CDATA[初识AIOps]]></title>
            <link>https://czasg.github.io/orange-ang/blog/DevOps&amp;AIOps</link>
            <guid>https://czasg.github.io/orange-ang/blog/DevOps&amp;AIOps</guid>
            <pubDate>Mon, 20 Jan 2025 00:00:00 GMT</pubDate>
            <description><![CDATA[DevOps 和 AIOps 是现代研发运维体系中的两个重要概念。]]></description>
            <content:encoded><![CDATA[<p>DevOps 和 AIOps 是现代研发运维体系中的两个重要概念。
其中，DevOps 侧重于开发和运维的协作与自动化，而 AIOps 则侧重利用 AI 技术优化运维。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="为什么需要aiops">为什么需要AIOps？<a href="https://czasg.github.io/orange-ang/blog/DevOps&amp;AIOps#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81aiops" class="hash-link" aria-label="为什么需要AIOps？的直接链接" title="为什么需要AIOps？的直接链接">​</a></h3>
<p>目前行业内各种新技术和新架构层出不穷，各类数据几乎都呈现爆炸式增长。面对这些海量数据，即使是最优秀的 SRE 团队，也几乎无法通过人力弥补这份差距。</p>
<p>在这种背景下，AIOps 理念应运而生。其旨在通过机器学习、人工智能的方式，自动学习并处理海量数据，协助 SRE 同学决策建议。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="devops和aiops有什么区别">DevOps和AIOps有什么区别？<a href="https://czasg.github.io/orange-ang/blog/DevOps&amp;AIOps#devops%E5%92%8Caiops%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB" class="hash-link" aria-label="DevOps和AIOps有什么区别？的直接链接" title="DevOps和AIOps有什么区别？的直接链接">​</a></h3>
<ul>
<li>DevOps 侧重于优化开发和运维之间的协作和自动化，旨在加快软件交付的速度和质量，强调团队合作和持续集成。</li>
<li>AIOps 侧重于利用人工智能和机器学习等技术来优化运维过程，通过数据分析和推理预测来实现智能化的运维管理。</li>
</ul>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br><br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>AI</category>
        </item>
        <item>
            <title><![CDATA[幽灵磁盘问题排查]]></title>
            <link>https://czasg.github.io/orange-ang/blog/磁盘问题排查</link>
            <guid>https://czasg.github.io/orange-ang/blog/磁盘问题排查</guid>
            <pubDate>Tue, 24 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[我们最近接手了一个服务，发现该服务所在的服务器在每天凌晨 3 点到 4 点之间，磁盘空间会突然被占满，但随后又会自动恢复。]]></description>
            <content:encoded><![CDATA[<p>我们最近接手了一个服务，发现该服务所在的服务器在每天凌晨 3 点到 4 点之间，磁盘空间会突然被占满，但随后又会自动恢复。</p>
<p>对方团队对此也感到困惑，我们初步推测可能是某个定时任务在执行过程中生成了大量临时文件，任务完成后自动删除了这些文件。
然而，令人费解的是，业务程序中并未设置凌晨 3 点到 4 点之间的定时任务，服务器上的 crontab 也没有相关记录。</p>
<p>经过初步排查，我们确认问题出在服务中的某个“幽灵”程序，该程序会在凌晨异常执行，导致磁盘空间被占满。
初步推测，该程序可能向 <code>/tmp</code> 或 <code>/var</code> 目录写入了大量数据。</p>
<p>为了进一步排查问题，我们编写了一个磁盘检查脚本，通过 crontab 定时启动。当磁盘利用率超过 70% 时触发日志记录，并生成详细的日志文件，帮助定位问题。</p>
<p>脚本的整体逻辑如下：</p>
<ol>
<li><strong>触发条件</strong>：当磁盘利用率超过 70% 时触发记录。</li>
<li><strong>日志生成</strong>：生成包含当前磁盘利用率的日志文件。</li>
<li><strong>系统状态记录</strong>：将 <code>top</code> 命令的输出写入日志文件，记录系统进程状态。</li>
<li><strong>大文件检查</strong>：<!-- -->
<ul>
<li>扫描 <code>/tmp</code> 目录，将大于 10 MB 的文件信息写入日志。</li>
<li>扫描 <code>/var</code> 目录，将大于 10 MB 的文件信息写入日志。</li>
</ul>
</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">disk-monitor.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义日志文件路径</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">LOG_DIR</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"/home/work/log/disk-monitor"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取当前时间</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">current_time</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">date</span><span class="token variable" style="color:rgb(156, 220, 254)"> +</span><span class="token variable string" style="color:rgb(206, 145, 120)">"%Y-%m-%d_%H-%M-%S"</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取根目录的磁盘使用率</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">disk_usage</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">df</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-h</span><span class="token variable" style="color:rgb(156, 220, 254)"> / </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">grep</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-v</span><span class="token variable" style="color:rgb(156, 220, 254)"> Filesystem </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">awk</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable string" style="color:rgb(206, 145, 120)">'{print $5}'</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">sed</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable string" style="color:rgb(206, 145, 120)">'s/%//'</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 检查磁盘使用率是否超过 70%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$disk_usage</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-gt</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">70</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义日志文件名，包含磁盘使用率信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">LOG_FILE</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_DIR</span><span class="token string" style="color:rgb(206, 145, 120)">/disk_usage_</span><span class="token string variable" style="color:rgb(156, 220, 254)">${disk_usage}</span><span class="token string" style="color:rgb(206, 145, 120)">.log"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 捕获 top 进程数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">top_output</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">top</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-b</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-n</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable number" style="color:rgb(181, 206, 168)">1</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">head</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-n</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable number" style="color:rgb(181, 206, 168)">50</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取 /tmp 目录下的文件信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">tmp_files</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">find</span><span class="token variable" style="color:rgb(156, 220, 254)"> /tmp </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-type</span><span class="token variable" style="color:rgb(156, 220, 254)"> f </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-size</span><span class="token variable" style="color:rgb(156, 220, 254)"> +10M </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-exec</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">du</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-h</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token variable" style="color:rgb(156, 220, 254)"> + </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">sort</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-rh</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取 /var/log 目录下的文件信息</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">var_log_files</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">find</span><span class="token variable" style="color:rgb(156, 220, 254)"> /var </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-type</span><span class="token variable" style="color:rgb(156, 220, 254)"> f </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-size</span><span class="token variable" style="color:rgb(156, 220, 254)"> +10M </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-exec</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">du</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-h</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token variable punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token variable" style="color:rgb(156, 220, 254)"> + </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">sort</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-rh</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token comment" style="color:rgb(106, 153, 85)"># 将数据写入日志文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"[</span><span class="token string variable" style="color:rgb(156, 220, 254)">$current_time</span><span class="token string" style="color:rgb(206, 145, 120)">] Disk usage on / is </span><span class="token string variable" style="color:rgb(156, 220, 254)">$disk_usage</span><span class="token string" style="color:rgb(206, 145, 120)">%. Top Process Data:"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$top_output</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"----------------------------------------"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"[</span><span class="token string variable" style="color:rgb(156, 220, 254)">$current_time</span><span class="token string" style="color:rgb(206, 145, 120)">] Files in /tmp:"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$tmp_files</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"----------------------------------------"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"[</span><span class="token string variable" style="color:rgb(156, 220, 254)">$current_time</span><span class="token string" style="color:rgb(206, 145, 120)">] Files in /var/log:"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$var_log_files</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"----------------------------------------"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">""</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">""</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$LOG_FILE</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>接着就是服务部署等待凌晨触发异常日志捕获...</p>
<p>next day...</p>
<p>经过一整天的日志追踪与分析，我们终于成功捕获了这个“幽灵”进程，揭开了它神秘的面纱。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/disk_used_45-f1397b977d687f52fb38411942c6de1b.png" class="image_FkF6" alt="Image">
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/disk_used_60-3deae7213430dc97f17c89a78d86d08e.png" class="image_FkF6" alt="Image">
<p>从以上监控截图中可以清晰地看到，一个名为 <code>updatedb</code> 的进程正在消耗大量系统资源，并且持续向 <code>/var/lib/mlocate</code> 目录写入临时数据。
（可算找到你了😤😤😤）</p>
<p>通过深入排查，我们发现 <code>updatedb</code> 进程是由 <code>mlocate</code> 工具触发的。<code>mlocate</code> 是一个用于快速定位文件的实用程序，
而 <code>updatedb</code> 是其用于更新文件索引数据库的核心任务。该任务被配置为系统级别的定时任务，
隐藏在 <code>/etc/cron.daily</code> 目录中，因此从普通用户视角通常无法直接观察到它的运行。</p>
<p>经过综合评估，考虑到当前服务器中大部分服务已处于下线准备阶段，仅需维持常规运维保障，
因此我们决定将 <code>mlocate</code> 的更新频率调整为<strong>月度更新</strong>。后续再观察下是否会导致其他问题。</p>
<p>最后，在结尾处记录下排查过程中涉及到的操作：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">查询全部用户的定时任务</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(156, 220, 254)">user</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">cut</span><span class="token variable" style="color:rgb(156, 220, 254)"> -d: </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-f1</span><span class="token variable" style="color:rgb(156, 220, 254)"> /etc/passwd</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"Crontab for user: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$user</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token function" style="color:rgb(220, 220, 170)">sudo</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">crontab</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-u</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$user</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-l</span><span class="token plain"> </span><span class="token operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain">/dev/null</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"----------------------------------------"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br><br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>待分类</category>
        </item>
        <item>
            <title><![CDATA[泛域名原理与证书获取实现]]></title>
            <link>https://czasg.github.io/orange-ang/blog/泛域名原理与证书获取实现</link>
            <guid>https://czasg.github.io/orange-ang/blog/泛域名原理与证书获取实现</guid>
            <pubDate>Sat, 21 Dec 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[随着互联网服务的多样化，越来越多的企业和开发者选择通过子域名和泛域名来简化域名管理和服务配置。泛域名允许一个通配符 * 替代子域名部分，从而匹配多个子域名。这种灵活性在多域名、云服务、微服务等架构中尤其重要。此外，多个域名共享一个 IP 地址时，正确的 SSL/TLS 证书获取和管理成为了一个技术挑战，尤其是在多个证书的服务器配置中，如何确保正确的证书被返回是一个关键问题。]]></description>
            <content:encoded><![CDATA[<p>随着互联网服务的多样化，越来越多的企业和开发者选择通过子域名和泛域名来简化域名管理和服务配置。泛域名允许一个通配符 <code>*</code> 替代子域名部分，从而匹配多个子域名。这种灵活性在多域名、云服务、微服务等架构中尤其重要。此外，多个域名共享一个 IP 地址时，正确的 SSL/TLS 证书获取和管理成为了一个技术挑战，尤其是在多个证书的服务器配置中，如何确保正确的证书被返回是一个关键问题。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1背景">1.背景<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#1%E8%83%8C%E6%99%AF" class="hash-link" aria-label="1.背景的直接链接" title="1.背景的直接链接">​</a></h3>
<p>随着证书巡检系统的上线，我们逐渐发现了一些治理方面的问题，主要包括：</p>
<ul>
<li>历史域名存在未维护的证书；</li>
<li>泛域名探测异常。</li>
</ul>
<p>在上一次的分享讨论中，我们意识到泛域名证书探测的逻辑可能存在一些缺陷。为了深入理解和解决这一问题，我们整理了本文档，旨在探讨泛域名的原理及其证书获取实现的可行方案。</p>
<p>本报告旨在：</p>
<ul>
<li>详细说明泛域名的原理，包括其如何与 DNS 解析机制协同工作。</li>
<li>探讨在存在多个证书的服务器上如何确保通过正确的 SNI 获取正确的证书。</li>
<li>
<ul>
<li>探讨泛域名证书获取方案。</li>
</ul>
</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2泛域名原理">2.泛域名原理<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#2%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86" class="hash-link" aria-label="2.泛域名原理的直接链接" title="2.泛域名原理的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21泛域名的定义">2.1.泛域名的定义<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#21%E6%B3%9B%E5%9F%9F%E5%90%8D%E7%9A%84%E5%AE%9A%E4%B9%89" class="hash-link" aria-label="2.1.泛域名的定义的直接链接" title="2.1.泛域名的定义的直接链接">​</a></h4>
<p>泛域名（Wildcard Domain）是指使用 <code>*</code> 通配符来表示域名的任意子域名。例如，<code>*.baidu.com</code> 表示所有以 <code>baidu.com</code> 为后缀的子域名（如 <code>www.baidu.com</code>、<code>mail.baidu.com</code>、<code>test.baidu.com</code> 等）都可以匹配到该泛域名。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22泛域名在-dns-中的作用">2.2.泛域名在 DNS 中的作用<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#22%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%9C%A8-dns-%E4%B8%AD%E7%9A%84%E4%BD%9C%E7%94%A8" class="hash-link" aria-label="2.2.泛域名在 DNS 中的作用的直接链接" title="2.2.泛域名在 DNS 中的作用的直接链接">​</a></h4>
<ul>
<li><strong>DNS 解析</strong>：在 DNS 解析过程中，当一个不存在的子域名（如 <code>123123123.baidu.com</code>）被请求时，若该域名符合配置的泛域名规则（如 <code>*.baidu.com</code>），DNS 会将请求解析到泛域名指定的 IP 地址。</li>
<li><strong>优先级</strong>：精确匹配优先。即如果 DNS 中有明确的子域名配置，它会优先被解析，而泛域名作为通配符规则，会匹配所有未显式定义的子域名。</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23泛域名的应用场景">2.3.泛域名的应用场景<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#23%E6%B3%9B%E5%9F%9F%E5%90%8D%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF" class="hash-link" aria-label="2.3.泛域名的应用场景的直接链接" title="2.3.泛域名的应用场景的直接链接">​</a></h4>
<ul>
<li><strong>大规模系统</strong>：对于需要管理大量子域名的企业或服务提供商，使用泛域名可以减少域名配置的复杂性。</li>
<li><strong>负载均衡和高可用性</strong>：在负载均衡或高可用性架构中，泛域名可以帮助简化流量转发和域名管理。</li>
<li><strong>多租户环境</strong>：在多租户系统中，泛域名可以用于为每个租户分配动态生成的子域名。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3证书获取原理与挑战">3.证书获取原理与挑战<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#3%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%8E%9F%E7%90%86%E4%B8%8E%E6%8C%91%E6%88%98" class="hash-link" aria-label="3.证书获取原理与挑战的直接链接" title="3.证书获取原理与挑战的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="31ssltls-证书基础">3.1.SSL/TLS 证书基础<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#31ssltls-%E8%AF%81%E4%B9%A6%E5%9F%BA%E7%A1%80" class="hash-link" aria-label="3.1.SSL/TLS 证书基础的直接链接" title="3.1.SSL/TLS 证书基础的直接链接">​</a></h4>
<p>在 HTTPS 通信中，SSL/TLS 证书用于加密通信并验证服务器身份。证书通常是与域名绑定的，并且包含公钥、签名等信息，用于建立安全的连接。</p>
<ul>
<li><strong>证书绑定</strong>：每个 SSL/TLS 证书是绑定特定域名的，例如 <code>www.baidu.com</code> 的证书仅适用于 <code>www.baidu.com</code>，无法用于 <code>mail.baidu.com</code> 或其他子域名。</li>
<li><strong>多证书服务器</strong>：许多服务器同时支持多个域名和多个证书，在这种情况下，如何确保为客户端提供正确的证书成为一个问题。</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="32sniserver-name-indication">3.2.SNI（Server Name Indication）<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#32sniserver-name-indication" class="hash-link" aria-label="3.2.SNI（Server Name Indication）的直接链接" title="3.2.SNI（Server Name Indication）的直接链接">​</a></h4>
<p>SNI 是 TLS 协议的一部分，允许客户端在建立 SSL/TLS 连接时，向服务器指明它希望连接的具体域名。服务器接收到该信息后，根据域名返回相应的证书。</p>
<ul>
<li><strong>SNI 的作用</strong>：在一个 IP 地址上部署多个证书时，SNI 允许客户端告知服务器要连接的具体域名，从而获取正确的证书。</li>
<li><strong>未使用 SNI 的情况</strong>：如果客户端没有提供 SNI（例如，某些旧版客户端），服务器可能返回默认的证书，而这个证书可能不是客户端期望的。</li>
</ul>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4泛域名验证流程">4.泛域名验证流程<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#4%E6%B3%9B%E5%9F%9F%E5%90%8D%E9%AA%8C%E8%AF%81%E6%B5%81%E7%A8%8B" class="hash-link" aria-label="4.泛域名验证流程的直接链接" title="4.泛域名验证流程的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="生成随机子域名">生成随机子域名<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#%E7%94%9F%E6%88%90%E9%9A%8F%E6%9C%BA%E5%AD%90%E5%9F%9F%E5%90%8D" class="hash-link" aria-label="生成随机子域名的直接链接" title="生成随机子域名的直接链接">​</a></h4>
<p>以 *.baidu.com 为例，随机生成一个子域名，如 <code>{timestamp}.baidu.com</code>，以验证泛域名是否正常生效。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置-sni">配置 SNI<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#%E9%85%8D%E7%BD%AE-sni" class="hash-link" aria-label="配置 SNI的直接链接" title="配置 SNI的直接链接">​</a></h4>
<p>由于泛域名本身是一种规则，因此可以将其作为 SNI 规则进行配置。在面对不同域名场景的复杂性时，可以设计多种 SNI 配置方案，以确保能够覆盖不同的使用场景并兼容多种配置：</p>
<ul>
<li>配置 SNI *.baidu.com：适用于所有以 baidu.com 为后缀的子域名，包括未显式配置的子域名。</li>
<li>配置 SNI baidu.com：用于指定根域名 baidu.com，适用于根域名本身的证书。</li>
<li>配置 SNI <code>www.baidu.com</code>：针对常见的 www 子域名进行配置，适用于该子域名特定的证书。</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="验证证书">验证证书<a href="https://czasg.github.io/orange-ang/blog/%E6%B3%9B%E5%9F%9F%E5%90%8D%E5%8E%9F%E7%90%86%E4%B8%8E%E8%AF%81%E4%B9%A6%E8%8E%B7%E5%8F%96%E5%AE%9E%E7%8E%B0#%E9%AA%8C%E8%AF%81%E8%AF%81%E4%B9%A6" class="hash-link" aria-label="验证证书的直接链接" title="验证证书的直接链接">​</a></h4>
<p>客户端可以通过以下步骤验证返回的证书：</p>
<ul>
<li>验证证书链：确保证书链中的每个证书都有效，且最终证书由受信任的证书颁发机构（CA）签发。</li>
<li>域名匹配：确保证书中的 Subject 或 SAN（Subject Alternative Name）字段与客户端请求的域名匹配。</li>
</ul>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br><br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>待分类</category>
        </item>
        <item>
            <title><![CDATA[Nebula数据库搭建]]></title>
            <link>https://czasg.github.io/orange-ang/blog/Nebula数据库搭建</link>
            <guid>https://czasg.github.io/orange-ang/blog/Nebula数据库搭建</guid>
            <pubDate>Mon, 10 Jun 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[本文记录 Nebula 图数据的搭建过程。]]></description>
            <content:encoded><![CDATA[<p>本文记录 Nebula 图数据的搭建过程。 <br>
文档参考：</p>
<ul>
<li><a href="https://docs.nebula-graph.com.cn/3.8.0/4.deployment-and-installation/1.resource-preparations/" target="_blank" rel="noopener noreferrer">准备资源 - NebulaGraph Database 手册</a></li>
<li><a href="https://docs.nebula-graph.com.cn/3.8.0/4.deployment-and-installation/2.compile-and-install-nebula-graph/2.install-nebula-graph-by-rpm-or-deb/" target="_blank" rel="noopener noreferrer">本地安装 - NebulaGraph Database 手册</a></li>
</ul>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="架构简介">架构简介<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#%E6%9E%B6%E6%9E%84%E7%AE%80%E4%BB%8B" class="hash-link" aria-label="架构简介的直接链接" title="架构简介的直接链接">​</a></h2>
<p>Nebula 采用计算存储分离架构，共包含三大组件：</p>
<ul>
<li>Graphd：负责处理计算请求</li>
<li>Metad：负责数据管理、集群管理和用户权限管理等</li>
<li>Storaged：服务负责存储数据
下图展示了 NebulaGraph 集群的经典架构：</li>
</ul>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/nebula-d1efd9a222d599b225415822f3fbe96b.png" class="image_FkF6" alt="Image">
<p>关于 Nabula 架构本文不做过多介绍，详情请见：<a href="https://docs.nebula-graph.com.cn/3.8.0/" target="_blank" rel="noopener noreferrer">NebulaGraph Database</a></p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="单节点部署">单节点部署<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#%E5%8D%95%E8%8A%82%E7%82%B9%E9%83%A8%E7%BD%B2" class="hash-link" aria-label="单节点部署的直接链接" title="单节点部署的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1服务安装">1.服务安装<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#1%E6%9C%8D%E5%8A%A1%E5%AE%89%E8%A3%85" class="hash-link" aria-label="1.服务安装的直接链接" title="1.服务安装的直接链接">​</a></h3>
<p>可以通过官方 RPM 包安装 NebulaGraph，本次安装版本3.8.0。
默认安装路径为 <code>/usr/local/nebula/</code>。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token function" style="color:rgb(220, 220, 170)">wget</span><span class="token plain"> https://oss-cdn.nebula-graph.com.cn/package/3.8.0/nebula-graph-3.8.0.el7.x86_64.rpm</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">rpm</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-ivh</span><span class="token plain"> nebula-graph-3.8.0.el7.x86_64.rpm</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2配置初始化">2.配置初始化<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#2%E9%85%8D%E7%BD%AE%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="2.配置初始化的直接链接" title="2.配置初始化的直接链接">​</a></h3>
<p>Nebula 提供了默认 .default 和生产 .production 两种配置。
我们采用 production 配置，并在此基础上做一定的调整：</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21meta服务配置">2.1.Meta服务配置<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#21meta%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="2.1.Meta服务配置的直接链接" title="2.1.Meta服务配置的直接链接">​</a></h4>
<p>配置文件路径：/usr/local/nebula/etc/nebula-metad.conf
配置调整项：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timezone_name=UTC+08:00</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--log_dir=/workspace/logs/nebula</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timestamp_in_logfile_name=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--max_log_size=1024</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--data_path=/workspace/data/nebula/meta</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22graph服务配置">2.2.Graph服务配置<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#22graph%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="2.2.Graph服务配置的直接链接" title="2.2.Graph服务配置的直接链接">​</a></h4>
<p>配置文件路径：/usr/local/nebula/etc/nebula-graphd.conf
配置调整项：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timezone_name=UTC+08:00</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--log_dir=/workspace/logs/nebula</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timestamp_in_logfile_name=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--max_log_size=1024</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--enable_authorize=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--enable_space_level_metrics=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--max_sessions_per_ip_per_user=500</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="23storage服务配置">2.3.Storage服务配置<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#23storage%E6%9C%8D%E5%8A%A1%E9%85%8D%E7%BD%AE" class="hash-link" aria-label="2.3.Storage服务配置的直接链接" title="2.3.Storage服务配置的直接链接">​</a></h4>
<p>配置文件路径：/usr/local/nebula/etc/nebula-storage.conf
配置调整项：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timezone_name=UTC+08:00</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--log_dir=/workspace/logs/nebula</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--timestamp_in_logfile_name=true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--max_log_size=1024</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">--data_path=/workspace/data/nebula/storage</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="52服务启动">5.2.服务启动<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#52%E6%9C%8D%E5%8A%A1%E5%90%AF%E5%8A%A8" class="hash-link" aria-label="5.2.服务启动的直接链接" title="5.2.服务启动的直接链接">​</a></h3>
<p>Nebula 涉及三个服务组件（graphd、metad、storaged），其中 metad 异常时数据库仍旧可以提供正常读，其余组件异常则整体服务异常。综合考虑，采用 Supervisor 部署 Nebula 相关服务。</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">nebula-supervisor.ini</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain">program:nebula-supervisor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">command</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/usr/local/nebula/scripts/nebula-supervisor.sh</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">directory</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/workspace/app/nebula</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">user</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">root</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">autostart</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">autorestart</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">startsecs</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">startretries</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stopsignal</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token environment constant" style="color:rgb(100, 102, 149)">TERM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stopwaitsecs</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stopasgroup</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">true</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stdout_logfile</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/workspace/logs/nebula/nebula-supervisor.log</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stderr_logfile</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">/workspace/logs/nebula/nebula-supervisor.err</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stdout_logfile_maxbytes</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">50MB</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">stdout_logfile_backups</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token number" style="color:rgb(181, 206, 168)">10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">nebula-supervisor.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># nebula 启动入口</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">function</span><span class="token plain"> </span><span class="token function-name function" style="color:rgb(220, 220, 170)">start_nebula</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/usr/local/nebula/scripts/nebula.service start </span><span class="token variable" style="color:rgb(156, 220, 254)">$1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$?</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-eq</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$(</span><span class="token string variable function" style="color:rgb(220, 220, 170)">date</span><span class="token string variable" style="color:rgb(156, 220, 254)">)</span><span class="token string" style="color:rgb(206, 145, 120)">: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$1</span><span class="token string" style="color:rgb(206, 145, 120)"> 服务启动成功。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$(</span><span class="token string variable function" style="color:rgb(220, 220, 170)">date</span><span class="token string variable" style="color:rgb(156, 220, 254)">)</span><span class="token string" style="color:rgb(206, 145, 120)">: </span><span class="token string variable" style="color:rgb(156, 220, 254)">$1</span><span class="token string" style="color:rgb(206, 145, 120)"> 服务启动失败。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">items</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token punctuation" style="color:rgb(212, 212, 212)">(</span><span class="token string" style="color:rgb(206, 145, 120)">"metad"</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"graphd"</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"storaged"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">while</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">do</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 无限循环</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">for</span><span class="token plain"> </span><span class="token for-or-select variable" style="color:rgb(156, 220, 254)">item</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">in</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">${items</span><span class="token string variable punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string variable" style="color:rgb(156, 220, 254)">@</span><span class="token string variable punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token string variable" style="color:rgb(156, 220, 254)">}</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">do</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 遍历列表中的每个元素</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">!</span><span class="token plain"> pgrep </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-x</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"nebula-</span><span class="token string variable" style="color:rgb(156, 220, 254)">$item</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> /dev/null  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 检查进程是否存在</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$(</span><span class="token string variable function" style="color:rgb(220, 220, 170)">date</span><span class="token string variable" style="color:rgb(156, 220, 254)">)</span><span class="token string" style="color:rgb(206, 145, 120)">: nebula-</span><span class="token string variable" style="color:rgb(156, 220, 254)">$item</span><span class="token string" style="color:rgb(206, 145, 120)"> 进程不存在，正在启动服务..."</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">start_nebula </span><span class="token variable" style="color:rgb(156, 220, 254)">$item</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$(</span><span class="token string variable function" style="color:rgb(220, 220, 170)">date</span><span class="token string variable" style="color:rgb(156, 220, 254)">)</span><span class="token string" style="color:rgb(206, 145, 120)">: nebula-</span><span class="token string variable" style="color:rgb(156, 220, 254)">$item</span><span class="token string" style="color:rgb(206, 145, 120)"> 进程正在运行。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">done</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">sleep</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">60</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 暂停60秒</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>更新下 supervisor 管理进程：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">supervisorctl reread</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">supervisorctl update</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>此时，我们可以看到已经跑起来了三个进程：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">$ </span><span class="token function" style="color:rgb(220, 220, 170)">ps</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-ef</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">|</span><span class="token plain"> </span><span class="token function" style="color:rgb(220, 220, 170)">grep</span><span class="token plain"> nebula</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">root     </span><span class="token number" style="color:rgb(181, 206, 168)">22026</span><span class="token plain">     </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">12</span><span class="token plain">:31 ?        00:00:07 /usr/local/nebula/bin/nebula-metad </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--flagfile</span><span class="token plain"> /usr/local/nebula/etc/nebula-metad.conf</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">root     </span><span class="token number" style="color:rgb(181, 206, 168)">28838</span><span class="token plain">     </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> May31 ?        00:00:31 /usr/local/nebula/bin/nebula-graphd </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--flagfile</span><span class="token plain"> /usr/local/nebula/etc/nebula-graphd.conf</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">root     </span><span class="token number" style="color:rgb(181, 206, 168)">28926</span><span class="token plain">     </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">  </span><span class="token number" style="color:rgb(181, 206, 168)">0</span><span class="token plain"> May31 ?        00:02:06 /usr/local/nebula/bin/nebula-storaged </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--flagfile</span><span class="token plain"> /usr/local/nebula/etc/nebula-storaged.conf</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="53日志初始化">5.3.日志初始化<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#53%E6%97%A5%E5%BF%97%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="5.3.日志初始化的直接链接" title="5.3.日志初始化的直接链接">​</a></h3>
<p>日志暂时不用收集，但仍然建议定期清除。
计划每天凌晨 3 点自动删除更新时间超过 7 天的 Graph 服务运行日志文件。
Crontab 指令参考如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">0 3 * * * find /workspace/logs/nebula -name nebula-graphd.* -mtime +7 -delete</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5.4.用户初始化</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">CREATE USER develop WITH PASSWORD 'develop';</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">GRANT ROLE USER ON develop TO develop;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>5.5.注册服务
Nebula 服务启动后不会自动执行注册，而需要用户手动注册 Storage 服务。
建议使用 docker 在本地搭建一个 studio 服务，docker 指令参考如下：</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run -it --rm -p 7001:7001 -e USER=root vesoft/nebula-graph-studio:v3.10</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>在 studio / console 中，我们可以通过以下指令添加 Storage 主机</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">ADD HOST 127.0.0.1:9779</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>至此，服务部署完成。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6服务监控">6.服务监控<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#6%E6%9C%8D%E5%8A%A1%E7%9B%91%E6%8E%A7" class="hash-link" aria-label="6.服务监控的直接链接" title="6.服务监控的直接链接">​</a></h2>
<p>Nebula 社区提供了一款用于监控 NebulaGraph 集群中机器和服务状态的可视化工具 Dashboard 。
目前作为单节点服务，建议仅监控机器本身状态。
因此建议监控方案：Node Exporter</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7数据备份">7.数据备份<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#7%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD" class="hash-link" aria-label="7.数据备份的直接链接" title="7.数据备份的直接链接">​</a></h2>
<p>Nebula 提供了两种备份方案：</p>
<ul>
<li>BR + Agent：社区提供的全量备份工具</li>
<li>SNAPSHOT：Nebula 自带的快照指令
通过初步调研发现二者存在一定区别。
社区工具BR支持全量备份以及一键恢复。而SNAPSHOT仅支持单个空间下的数据快照，并且恢复时需要手动拷贝文件到指定目录，存在一定的操作风险。
因此此处部署采用社区备份工具实施数据备份，备份流程为：</li>
</ul>
<ol>
<li>执行备份指令</li>
<li>备份文件压缩</li>
<li>上传备份数据至云端
备份脚本名参考：</li>
</ol>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">nebula-backup.sh</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token shebang important">#!/bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 获取当前日期</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">today</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">date</span><span class="token variable" style="color:rgb(156, 220, 254)"> +</span><span class="token variable string" style="color:rgb(206, 145, 120)">"%Y_%m_%d"</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 运行备份命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">/usr/local/nebula/bin/br backup full </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--meta</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"127.0.0.1:9559"</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">--storage</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"local:///usr/local/nebula/backup/"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 找到今天生成的最新备份目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">backup_dir</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">find</span><span class="token variable" style="color:rgb(156, 220, 254)"> /usr/local/nebula/backup/ </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-type</span><span class="token variable" style="color:rgb(156, 220, 254)"> d </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-name</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable string" style="color:rgb(206, 145, 120)">"BACKUP_</span><span class="token variable string variable" style="color:rgb(156, 220, 254)">${today}</span><span class="token variable string" style="color:rgb(206, 145, 120)">_*"</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">sort</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable operator" style="color:rgb(212, 212, 212)">|</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable function" style="color:rgb(220, 220, 170)">tail</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable parameter variable" style="color:rgb(156, 220, 254)">-n</span><span class="token variable" style="color:rgb(156, 220, 254)"> </span><span class="token variable number" style="color:rgb(181, 206, 168)">1</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 检查是否找到备份目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-z</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">$backup_dir</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"未找到今天生成的备份目录。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 生成压缩文件的名称</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">backup_name</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">basename</span><span class="token variable" style="color:rgb(156, 220, 254)"> $backup_dir</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(156, 220, 254)">tar_file</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token string variable" style="color:rgb(156, 220, 254)">${backup_name}</span><span class="token string" style="color:rgb(206, 145, 120)">.tar.gz"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用 tar 压缩备份目录</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token function" style="color:rgb(220, 220, 170)">tar</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-czvf</span><span class="token plain"> /usr/local/nebula/backup/</span><span class="token variable" style="color:rgb(156, 220, 254)">$tar_file</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-C</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$(</span><span class="token variable function" style="color:rgb(220, 220, 170)">dirname</span><span class="token variable" style="color:rgb(156, 220, 254)"> $backup_dir</span><span class="token variable" style="color:rgb(156, 220, 254)">)</span><span class="token plain"> </span><span class="token variable" style="color:rgb(156, 220, 254)">$backup_name</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> /dev/null </span><span class="token operator file-descriptor important" style="color:rgb(212, 212, 212)">2</span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token file-descriptor important">&amp;1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 检查是否成功生成压缩文件</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token plain"> </span><span class="token parameter variable" style="color:rgb(156, 220, 254)">-f</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"/usr/local/nebula/backup/</span><span class="token string variable" style="color:rgb(156, 220, 254)">$tar_file</span><span class="token string" style="color:rgb(206, 145, 120)">"</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token punctuation" style="color:rgb(212, 212, 212)">;</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(86, 156, 214)">then</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"成功压缩目录 </span><span class="token string variable" style="color:rgb(156, 220, 254)">${backup_dir}</span><span class="token string" style="color:rgb(206, 145, 120)"> 为文件 /usr/local/nebula/backup/</span><span class="token string variable" style="color:rgb(156, 220, 254)">${tar_file}</span><span class="token string" style="color:rgb(206, 145, 120)">。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">else</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">echo</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"压缩失败。"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token builtin class-name" style="color:rgb(78, 201, 176)">exit</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token keyword" style="color:rgb(86, 156, 214)">fi</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8集群拓展">8.集群拓展<a href="https://czasg.github.io/orange-ang/blog/Nebula%E6%95%B0%E6%8D%AE%E5%BA%93%E6%90%AD%E5%BB%BA#8%E9%9B%86%E7%BE%A4%E6%8B%93%E5%B1%95" class="hash-link" aria-label="8.集群拓展的直接链接" title="8.集群拓展的直接链接">​</a></h2>
<p>Nebula 集群改造期间需要停服，服务需要中断。
集群搭建可以通过修改配置完成，暂不关注。
而整个扩展的核心在于 storage 组件的数据负载是否均衡。
目前 Nubula 支持使用命令SUBMIT JOB BALANCE LEADER均衡分布所有图空间中的 Leader 分片副本。但集群场景下效果如何，待验证。</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂<br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>nebula</category>
            <category>图数据库</category>
        </item>
        <item>
            <title><![CDATA[云原生技术探索]]></title>
            <link>https://czasg.github.io/orange-ang/blog/云原生技术探索</link>
            <guid>https://czasg.github.io/orange-ang/blog/云原生技术探索</guid>
            <pubDate>Tue, 30 Apr 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[如果在10年前，有人给你做 容器、云原生，Serverless的分享，你肯定会以为这个人是个大忽悠。特别是如果你在当时就有了一定的知识积累，你更可能觉得这些技术，都只不过是“新瓶装旧酒”，不值得过度关注。]]></description>
            <content:encoded><![CDATA[<p>如果在10年前，有人给你做 容器、云原生，Serverless的分享，你肯定会以为这个人是个大忽悠。特别是如果你在当时就有了一定的知识积累，你更可能觉得这些技术，都只不过是“新瓶装旧酒”，不值得过度关注。</p>
<p>但技术的演进，往往就是从 <strong>“看不到 / 看不起” =&gt; "看不懂" =&gt; "跟不上"</strong>。</p>
<p>但无论现阶段的我们处于那种状态，在当前容器化时代，掌握容器引擎、容器编排管理工具的使用，了解其基础概念与原理，这都将有助于日常工作的开展。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1云计算演进史">1.云计算演进史<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#1%E4%BA%91%E8%AE%A1%E7%AE%97%E6%BC%94%E8%BF%9B%E5%8F%B2" class="hash-link" aria-label="1.云计算演进史的直接链接" title="1.云计算演进史的直接链接">​</a></h2>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>云计算</div><div class="admonitionContent_BuS1"><p>云计算是通过互联网提供计算资源与服务，用户按需获取，无需拥有硬件，实现灵活、经济高效的计算模式，而无需在本地拥有和维护硬件和软件。</p><p>简单来说：云计算是一种服务模式，它通过互联网出租云服务器。</p></div></div>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>云原生</div><div class="admonitionContent_BuS1"><p>CNCF（Cloud Native Computing Foundation，云原生计算基金会）对云原生的定义：云原生技术是有利于各组织在公有云、私有云和混合云等新型动态环境中，构建和运行可弹性扩展的应用技术。其代表技术包括：容器、服务网格、微服务、不可变基础设施和声明式 API 等。</p><p>简单来说：云原生是一种软件技术架构，在云计算的基础上，实现了：</p><ul>
<li>应用容器化</li>
<li>容器编排化（横向扩容、滚动升级、负载均衡、容灾备份等）</li>
</ul></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="11虚拟化技术落地">1.1.虚拟化技术落地<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#11%E8%99%9A%E6%8B%9F%E5%8C%96%E6%8A%80%E6%9C%AF%E8%90%BD%E5%9C%B0" class="hash-link" aria-label="1.1.虚拟化技术落地的直接链接" title="1.1.虚拟化技术落地的直接链接">​</a></h3>
<p>虚拟化技术是一种资源管理技术，在各种实体资源（CPU、内存、网络、存储等）之上构建一个逻辑层，从而摆脱物理限制的约束，提高物理资源的利用率。</p>
<ul>
<li>2001 年 VMware 发布 VMware ESX。它可以在同一台物理机上运行多个虚拟机。这意味着虚拟化技术真正得到了落地，服务器的数量将下降，与之对应的是，服务器资源将得到更加充分的利用。 <br></li>
<li>2006 年 AWS 首创按时计费的方式租借服务器，揭开了云计算时代帷幕。 <br></li>
<li>2008 年 Alibaba 开始筹备阿里云，云计算逐渐成为计算机领域最令人关注的话题之一。 <br></li>
<li>2010 年 openstack 发布第一个开源版本，云计算正式进入开源时代。 <br></li>
</ul>
<p>小结：虚拟化技术 提高了 物理资源的利用率。极大的提升了硬件价值上限。</p>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="12容器化技术落地">1.2.容器化技术落地<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#12%E5%AE%B9%E5%99%A8%E5%8C%96%E6%8A%80%E6%9C%AF%E8%90%BD%E5%9C%B0" class="hash-link" aria-label="1.2.容器化技术落地的直接链接" title="1.2.容器化技术落地的直接链接">​</a></h3>
<p>容器化技术同样也是一种资源管理技术，它是在复用系统内核的基础之上，对实体资源（网络、进程、存储等）进一步的构建一个逻辑层。因此相比对虚拟化技术，容器化技术隔离是不彻底的，但更轻量级。</p>
<ul>
<li>2013 年 docker 发布。容器在多数领域逐步替代 VM，云计算进入容器时代。 <br></li>
<li>2018 年 kubernetes 基本全面赢得容器编排市场的胜利，云计算进入 K8S 时代。 <br></li>
</ul>
<p>小结：容器化技术 建立在 虚拟化技术优势之上，不仅大幅提高了资源的利用率，还提供更轻量级的管理方式。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2云原生代表技术">2.云原生代表技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2%E4%BA%91%E5%8E%9F%E7%94%9F%E4%BB%A3%E8%A1%A8%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.云原生代表技术的直接链接" title="2.云原生代表技术的直接链接">​</a></h2>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="21容器技术docker">2.1.容器技术（docker）<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#21%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AFdocker" class="hash-link" aria-label="2.1.容器技术（docker）的直接链接" title="2.1.容器技术（docker）的直接链接">​</a></h3>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="211什么场景下可以使用容器技术">2.1.1.什么场景下可以使用容器技术?<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#211%E4%BB%80%E4%B9%88%E5%9C%BA%E6%99%AF%E4%B8%8B%E5%8F%AF%E4%BB%A5%E4%BD%BF%E7%94%A8%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.1.1.什么场景下可以使用容器技术?的直接链接" title="2.1.1.什么场景下可以使用容器技术?的直接链接">​</a></h4>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">某公司...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：服务是否可以直接部署在内部的虚拟机上</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：可以，但不建议，你们自己部署的服务，没有运维保障，容易背锅</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：可是我们之前公司都是部署在自己的虚拟机上</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：你可以把服务构建镜像，然后用容器去跑</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：没必要啊，我环境都配好了，直接跑不是一样的，性能还更好...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：那如果这台虚拟机有问题，你能确保服务快速恢复吗</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">研发：可以，程序依赖都已经打包好了（jar / venv / static / bin），可以快速重新部署恢复</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">组长：ojbk</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">... ...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">某天，虚拟机裂开了，研发跑路，运维接坑...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">运维：完了，这叼毛 jar 怎么跑不起来，一堆飘红额...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">运维：完了，这叼毛 php 是跑起来了还是没跑起来...</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">... ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>上述场景，粗看是一个技术壁垒问题。本质应该还是一个管理问题（交接文档没有写清楚，部署说明没有介绍清楚等...）。 <br>
但是，这个案列又非常经典，因为技术壁垒导致的项目管理复杂度上升，是非常常见的。 <br>
特别是对一些交付源码的项目，这种项目往往高度依赖环境准备... <br></p>
<p>如果有一种技术，它可以定义一种通用的交付产物，消除研发、测试、运维、产品之间的强技术壁垒，并在整个项目生命周期内达成一种通用的“语言”。那这个技术，简直泰裤辣。</p>
<p>而 docker，就是这么一门技术。 <br>
它创新性的引入了镜像概念，重新定义了交付产物，让不同的服务之间，可以以近乎相似的方式进行维护。 <br>
也正是因为镜像的引入，彻底掀起了容器化的热潮~ <br></p>
<p>答案：除了不能用使用容器的场景，否则都推荐使用容器技术~</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="212一个简单的容器场景">2.1.2.一个简单的容器场景<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#212%E4%B8%80%E4%B8%AA%E7%AE%80%E5%8D%95%E7%9A%84%E5%AE%B9%E5%99%A8%E5%9C%BA%E6%99%AF" class="hash-link" aria-label="2.1.2.一个简单的容器场景的直接链接" title="2.1.2.一个简�单的容器场景的直接链接">​</a></h4>
<p>场景：前端编译后需要对外发布</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">1-编译镜像</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 镜像拉取</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker pull nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 镜像模板</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> vim Dockerfile</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">1.</span><span class="token plain"> FROM nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">2.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">3.</span><span class="token plain"> COPY </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">dist</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"> </span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">usr</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">share</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">nginx</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">html</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token number" style="color:rgb(181, 206, 168)">4.</span><span class="token plain"> EXPOSE </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 编译镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker build </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">t harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest </span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">2-推送镜像</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 登录镜像仓库</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker login harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 推送镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker push harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockTitle_Ktv7">3-运行容器</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)">### 登录远程服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> ssh xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">xx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 拉取镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker pull harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)">### 启动服务</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token operator" style="color:rgb(212, 212, 212)">&gt;</span><span class="token plain"> docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">itd </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">p </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"> harbor</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">avlyun</span><span class="token punctuation" style="color:rgb(212, 212, 212)">.</span><span class="token plain">org</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">developer</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">center</span><span class="token operator" style="color:rgb(212, 212, 212)">/</span><span class="token plain">web</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">fe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="213容器核心技术">2.1.3.容器核心技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#213%E5%AE%B9%E5%99%A8%E6%A0%B8%E5%BF%83%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.1.3.容器核心技术的直接链接" title="2.1.3.容器核心技术的直接链接">​</a></h4>
<ul>
<li>cgroups：可以控制进程资源的使用。如：CPU、内存 等。</li>
<li>namespace：可以控制进程资源的隔离。如：网络、存储 等。</li>
<li>unionfs：可以将多个目录联合挂载到一个统一的目录。（可以简单认为是一种只读的软链接）</li>
</ul>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="214docker核心概念">2.1.4.docker核心概念<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#214docker%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5" class="hash-link" aria-label="2.1.4.docker核心概念的直接链接" title="2.1.4.docker核心概念的直接链接">​</a></h4>
<ul>
<li>镜像</li>
<li>网络</li>
<li>存储卷</li>
</ul>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2141镜像">2.1.4.1.镜像<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2141%E9%95%9C%E5%83%8F" class="hash-link" aria-label="2.1.4.1.镜像的直接链接" title="2.1.4.1.镜像的直接链接">​</a></h5>
<p>镜像是构建和运行容器的基础。我们可以把镜像理解为一个只读的模板，或者是压缩包，它包含了运行一个应用程序所需要的所有内容：</p>
<ul>
<li>应用程序（源码/编译产物）</li>
<li>运行时环境</li>
<li>系统工具</li>
<li>三方库依赖</li>
<li>配置参数</li>
<li>... ...</li>
</ul>
<p>我们完全可以把镜像理解为一个独立且完整的应用程序包。</p>
<p>思考：镜像和之前所提到的交付产物有何区别。</p>
<p>镜像由一系列的层组成，每个层都代表着镜像的一部分。这些层在构建镜像时按照顺序添加，并且都是只读的，因此在构建相同层时可以复用，从而节省存储空间。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-f14d8b9ca62710bba57b811debcbfbe7.jpg" class="image_FkF6" alt="Image">
<p>自己构建一个镜像</p>
<div class="language-dockerfile codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">FROM ubuntu:15.04</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">mkdir /workplace</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">echo -n &gt; /workplace/README.md</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-2-b693486394a9a9a6fd03b7aff62b0d49.png" class="image_FkF6" alt="Image">
<p>镜像最终会通过类似一种堆积木的方式呈现出来。从技术角度来讲，这是通过联合文件系统实现的。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/image-layer-3-ac6868d010d30050e868d8c19a34827a.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2142网络">2.1.4.2.网络<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2142%E7%BD%91%E7%BB%9C" class="hash-link" aria-label="2.1.4.2.网络的直接链接" title="2.1.4.2.网络的直接链接">​</a></h5>
<p>在 docker 中，网络是一种用于容器间通信的机制。在同一个虚拟网络下，不同容器之间是可以相互访问的。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-c86471da8bec93f73ac0fb7b65615909.png" class="image_FkF6" alt="Image">
<p>为了确保容器所处网络环境隔离性，可以通过自定义虚拟网络来实现。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 创建网络network1和network2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container1 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network2中创建容器container2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container2 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network2 your_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-1-a1fa19a2353e36cec02fd16f591a7f2c.png" class="image_FkF6" alt="Image">
<p>为了进一步的实现网络资源共享，可以通过网络连接的方式，将多容器连接到某一个容器，从而复用指定容器的网络（IP）资源。</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token comment" style="color:rgb(106, 153, 85)"># 创建网络network1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker network create network1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container1 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network network1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token comment" style="color:rgb(106, 153, 85)"># 在network1中创建容器container2、container3，并连接到container1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container2 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">container1 your_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name container3 </span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token operator" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network</span><span class="token operator" style="color:rgb(212, 212, 212)">=</span><span class="token plain">container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">container1 your_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/network-2-b2fc5b0dd4dc2389efc967e539696cf8.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2143存储卷">2.1.4.3.存储卷<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#2143%E5%AD%98%E5%82%A8%E5%8D%B7" class="hash-link" aria-label="2.1.4.3.存储卷的直接链接" title="2.1.4.3.存储卷的直接链接">​</a></h5>
<p>在 docker 中，存储卷是一种特殊的文件目录或者文件，用于在容器和宿主机之间实现持久化存储数据。</p>
<p>和镜像层的只读层不同的是，存储卷拥有：</p>
<ul>
<li>持久化的</li>
<li>共享的</li>
<li>独立于容器生命周期的</li>
</ul>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain"># -v</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run -v /host/path:/container/path my_image</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"># --mount</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run --mount type=bind,source=/host/path,target=/container/path my_image</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="22容器编排技术">2.2.容器编排技术<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#22%E5%AE%B9%E5%99%A8%E7%BC%96%E6%8E%92%E6%8A%80%E6%9C%AF" class="hash-link" aria-label="2.2.容器编排技术的直接链接" title="2.2.容器编排技术的直接链接">​</a></h3>
<p>容器编排技术本质就是管理容器的技术。</p>
<p>为什么需要使用容器编排技术，容器编排和容器之间的关系，就类似 虚拟机 和 openstack 之间的关系，对于大型容器集群，需要有便捷的工具来管理。</p>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="221k8s集��群架构">2.2.1.k8s集群架构<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#221k8s%E9%9B%86%E7%BE%A4%E6%9E%B6%E6%9E%84" class="hash-link" aria-label="2.2.1.k8s集群架构的直接链接" title="2.2.1.k8s集群架构的直接链接">​</a></h4>
<p>k8s 就是目前市面上最成功的容器编排实现标准。</p>
<p>它是经典的主从架构，分别是：contaol-plane 和 node。</p>
<table><thead><tr><th>归属</th><th>服务</th><th>说明</th></tr></thead><tbody><tr><td>control-plane</td><td>kube-api-server</td><td>k8s 网关服务，用于接收所有 k8s 请求并进行处理</td></tr><tr><td>control-plane</td><td>kube-controller-manager</td><td>k8s 控制器，负责监控系统状态与变化，确保目标状态符合期望状态</td></tr><tr><td>control-plane</td><td>kube-scheduler</td><td>k8s 调度器，统筹所有节点资源，负责和节点交互，并基于一定的规则（亲和性、反亲和性）进行资源调度</td></tr><tr><td>control-plane</td><td>etcd</td><td>分布式键值对存储系统</td></tr><tr><td>node</td><td>kubectl</td><td>节点上的代理服务，负责该节点的运行状态、容器管理等</td></tr><tr><td>node</td><td>kube-proxy</td><td>维护该节点上的网络规则，以确保服务能够被正确发现</td></tr><tr><td>node</td><td>container-runtime</td><td>容器引擎，负责容器管理，包括：创建、删除等</td></tr><tr><td>node</td><td>pod</td><td>k8s 集群中最小的可部署单元。也是集群中单服务的高层抽象</td></tr></tbody></table>
<p>我们可以通过熟悉 k8s 的交互流程来熟悉 k8s 架构。下面演示一次完整的 <code>kubectl apply -f deploy.yaml</code> 执行流程。</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-96f8760b04718c0e5d8d3ec402761a71.png" class="image_FkF6" alt="Image">
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="322pod详解">3.2.2.pod详解<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#322pod%E8%AF%A6%E8%A7%A3" class="hash-link" aria-label="3.2.2.pod详解的直接链接" title="3.2.2.pod详解的直接链接">​</a></h4>
<p>如果 k8s 是以 docker 作为容器引擎，那么我们完全可以在本地通过 docker 模拟出 pod 的行为。</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">DockerCompose</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'3'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"80:80"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<p>对于简单场景下的单容器 Pod 来说，k8s 和 docker 部署的服务几乎没有任何区别。</p>
<p>但是，在多容器场景下，Pod 对外表现出来的更像是一个整体，因为他们对外只有一个 IP ~</p>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">DockerCompose</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">CMD</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">8080</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">version</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'3'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">services</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"80:80"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"8080:8080"</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker create network pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name pause </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=pod pause</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name nginx </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">pause nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">docker run </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">d </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">name server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">network=container</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">pause server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<p>对于这种场景下，我们可以通过容器连接来实现，但问题是，以谁为根容器作为被其他容器连接的对象呢？</p>
<p>PS：根容器的特点：稳定</p>
<p>Pod 详解</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-2-42b2d98c2371440a8c6ea8171cb5a094.png" class="image_FkF6" alt="Image">
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">initContainers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 初始化容器列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> init</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> busybox</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">'sh'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'-c'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">'echo Initializing... &amp;&amp; sleep 5'</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 执行初始化操作，输出消息并休眠5秒钟</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 主容器列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">container</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">lifecycle</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义容器的生命周期钩子</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">postStart</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">exec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"/bin/sh"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"-c"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"echo Container started."</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 在容器启动后执行的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">preStop</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">exec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token key atrule">command</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">[</span><span class="token string" style="color:rgb(206, 145, 120)">"/bin/sh"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"-c"</span><span class="token punctuation" style="color:rgb(212, 212, 212)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"echo Container stopping..."</span><span class="token punctuation" style="color:rgb(212, 212, 212)">]</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 在容器停止前执行的命令</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">readinessProbe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 就绪性检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器启动后等待5秒再进行第一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 间隔5秒进行一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">livenessProbe</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 存活性检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">httpGet</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">initialDelaySeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">10</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器启动后等待10秒再进行第一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">periodSeconds</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">5</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 间隔5秒进行一次检查</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器的挂载点</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /usr/share/nginx/html  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 将 emptyDir 卷挂载到容器的 /usr/share/nginx/html 路径，实现数据共享</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 卷列表</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> shared</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">data</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">emptyDir</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 空目录卷，用于在 init-container 和主容器之间共享数据</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">restartPolicy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Always  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器的重启策略，始终重启</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="323常用资源对象介绍">3.2.3.常用资源对象介绍<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#323%E5%B8%B8%E7%94%A8%E8%B5%84%E6%BA%90%E5%AF%B9%E8%B1%A1%E4%BB%8B%E7%BB%8D" class="hash-link" aria-label="3.2.3.常用资源对象介绍的直接链接" title="3.2.3.常用资源对象介绍的直接链接">​</a></h4>
<p>在 k8s 集群中，一般不直接使用 pod。因为 pod 的生命周期被视为短暂的~</p>
<p>为了更好的去管理集群中的 pod 应用，k8s 集群引入了其他的资源对象。</p>
<table><thead><tr><th>资源对象</th><th>说明</th><th>其他</th></tr></thead><tbody><tr><td>Deployment</td><td></td><td></td></tr><tr><td>Service</td><td>一组服务的抽象</td><td>dns</td></tr><tr><td>Ingress</td><td>路由规则集，用于控制集群外部流量导入</td><td>nginx</td></tr><tr><td>ConfigMap</td><td>配置中心</td><td></td></tr></tbody></table>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/k8s-3-27bba66d4a2ccb9dd293876fdda6c2a6.png" class="image_FkF6" alt="Image">
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3231configmap">3.2.3.1.configmap<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3231configmap" class="hash-link" aria-label="3.2.3.1.configmap的直接链接" title="3.2.3.1.configmap的直接链接">​</a></h5>
<p>configmap 是键值对配置，可以以环境变量或者文件的形式注入进 pod。</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ConfigMap</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">data</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">LOG_LEVEL</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> debug</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">LOG_FORMAT</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> json</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">NGINX_CONFIG_FILE</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(212, 212, 212)">|</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    server </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        listen       80;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        server_name  localhost;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location / </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            index  index.html index.htm;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        error_page   500 502 503 504  /50x.html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        location = /50x.html </span><span class="token punctuation" style="color:rgb(212, 212, 212)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            root   /usr/share/nginx/html;</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token punctuation" style="color:rgb(212, 212, 212)">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">envFrom</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 指定环境变量来源于configMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">configMapRef</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">env</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 直接在pod中指定需要哪些环境变量，此优先级最高</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"LOG_LEVEL"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"error"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"LOG_FORMAT"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">value</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(206, 145, 120)">"text"</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">volumeMounts</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 通过文件的形式注入pod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">mountPath</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /etc/nginx/conf.d/</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">volumes</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">configMap</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 指定存储卷类型为configMap</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">defaultMode</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">420</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">items</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">key</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> NGINX_CONFIG_FILE </span><span class="token comment" style="color:rgb(106, 153, 85)"># 仅取出其中某个key</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> default.conf</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">conf</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">file</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3232ingress">3.2.3.2.ingress<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3232ingress" class="hash-link" aria-label="3.2.3.2.ingress的直接链接" title="3.2.3.2.ingress的直接链接">​</a></h5>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> extensions/v1beta1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Ingress</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">rules</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">host</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx.hsk8s</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">dev.avlyun.org</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">http</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">paths</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /download</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /api/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">          </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">path</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> /api/v2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">            </span><span class="token key atrule">backend</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">serviceName</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> server</span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain">v2</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">              </span><span class="token key atrule">servicePort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3233service">3.2.3.3.service<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3233service" class="hash-link" aria-label="3.2.3.3.service的直接链接" title="3.2.3.3.service的直接链接">​</a></h5>
<p>service 是一组服务的抽象，可用于 DNS 解析，其解析的结果，是对应 Pod 的 IP 集合。</p>
<p>因此，我们完全可以把 service 当做一个合法的域名来使用。下面通过执行 <code>curl nginx.fos-2-dev</code> 来展示 service 的魅力~</p>
<div class="undefined"></div><img src="https://czasg.github.io/orange-ang/assets/images/service-8dab6971183dc9337acef1d22f9af576.png" class="image_FkF6" alt="Image">
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Service</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义一组服务中的端口转发</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">port</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">protocol</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> TCP</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">targetPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token comment" style="color:rgb(106, 153, 85)"># 定义一组服务（pod）标签</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> ClusterIP</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>问题：在 k8s 集群中，到底应该如何访问其他服务？</p>
<p>答案：应该通过 service.namespace 来访问，直接端到端的跑流量，而不用走 ingress 转发。</p>
<h5 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3231deployment">3.2.3.1.deployment<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#3231deployment" class="hash-link" aria-label="3.2.3.1.deployment的直接链接" title="3.2.3.1.deployment的直接链接">​</a></h5>
<div class="browserWindow_my1Q"><div class="browserWindowHeader_jXSR"><div class="buttons_uHc7"><span class="dot_giz1" style="background:#f25f58"></span><span class="dot_giz1" style="background:#fbbe3c"></span><span class="dot_giz1" style="background:#58cb42"></span></div><div class="browserWindowAddressBar_Pd8y text--truncate">http://localhost:3000</div><div class="browserWindowMenuIcon_Vhuh"><div><span class="bar_rrRL"></span><span class="bar_rrRL"></span><span class="bar_rrRL"></span></div></div></div><div class="browserWindowBody_Idgs"><div class="tabs-container tabList__CuJ"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_LNqP tabs__item--active">Pod</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Deployment/RollingUpdate</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_LNqP">Deployment/Recreate</li></ul><div class="margin-top--md"><div role="tabpanel" class="tabItem_Ymn6"><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Pod</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 副本数为 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">rollingUpdate</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">maxSurge</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> 50%  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 允许的最大超出副本数，支持整数，也支持百分比</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">maxUnavailable</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">1</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 允许的最大不可用副本数，支持整数，也支持百分比</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> RollingUpdate  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用滚动升级策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用最新版本的 Nginx 镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器监听端口 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div><div role="tabpanel" class="tabItem_Ymn6" hidden=""><div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#9CDCFE;--prism-background-color:#1E1E1E"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#9CDCFE;background-color:#1E1E1E"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#9CDCFE"><span class="token key atrule">apiVersion</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> apps/v1</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">kind</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Deployment</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain"></span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">replicas</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">3</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 副本数为 3</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">selector</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">matchLabels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">strategy</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">type</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> Recreate </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用重建升级策略</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">  </span><span class="token key atrule">template</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">metadata</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">labels</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">app</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">    </span><span class="token key atrule">spec</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token key atrule">containers</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">name</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">image</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> nginx</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain">latest  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 使用最新版本的 Nginx 镜像</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token key atrule">ports</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#9CDCFE"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(212, 212, 212)">-</span><span class="token plain"> </span><span class="token key atrule">containerPort</span><span class="token punctuation" style="color:rgb(212, 212, 212)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(181, 206, 168)">80</span><span class="token plain">  </span><span class="token comment" style="color:rgb(106, 153, 85)"># 容器监听端口 80</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div></div></div></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4答疑">4.答疑<a href="https://czasg.github.io/orange-ang/blog/%E4%BA%91%E5%8E%9F%E7%94%9F%E6%8A%80%E6%9C%AF%E6%8E%A2%E7%B4%A2#4%E7%AD%94%E7%96%91" class="hash-link" aria-label="4.答疑的直接链接" title="4.答疑的直接链接">​</a></h2>
<p>... ...</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>待分类</category>
        </item>
        <item>
            <title><![CDATA[结构化思维实战-深度思考模型]]></title>
            <link>https://czasg.github.io/orange-ang/blog/structure-mind-deep-thinking</link>
            <guid>https://czasg.github.io/orange-ang/blog/structure-mind-deep-thinking</guid>
            <pubDate>Mon, 25 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[摘要在此处]]></description>
            <content:encoded><![CDATA[<p>摘要在此处</p>
<p>正文在此处</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>结构化思维实战</category>
        </item>
        <item>
            <title><![CDATA[结构化思维实战-鼓励赋能模型]]></title>
            <link>https://czasg.github.io/orange-ang/blog/structure-mind-encourage-model</link>
            <guid>https://czasg.github.io/orange-ang/blog/structure-mind-encourage-model</guid>
            <pubDate>Mon, 25 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[摘要在此处]]></description>
            <content:encoded><![CDATA[<p>摘要在此处</p>
<p>正文在此处</p>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>结构化思维实战</category>
        </item>
        <item>
            <title><![CDATA[docusaurus 搭建 github 站点教程]]></title>
            <link>https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages</link>
            <guid>https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages</guid>
            <pubDate>Fri, 22 Mar 2024 00:00:00 GMT</pubDate>
            <description><![CDATA[本文记录如何基于 docusaurus 从0到1搭建 github 免费个人站点，并通过 github-actions 实现自动部署。]]></description>
            <content:encoded><![CDATA[<p>本文记录如何基于 docusaurus 从0到1搭建 github 免费个人站点，并通过 github-actions 实现自动部署。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化仓库">初始化仓库<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96%E4%BB%93%E5%BA%93" class="hash-link" aria-label="初始化仓库的直接链接" title="初始化仓库的直接链接">​</a></h2>
<p>进入<a href="https://github.com/new" target="_blank" rel="noopener noreferrer">github仓库创建页面</a>，我们创建一个全新的空白仓库，项目名命名为 <code>myblog</code>。</p>
<p>接着，我们新建 gh-pages 分支，并修改 pages 配置，将部署信息指向我们新建的 gh-pages 分支。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="创建-codespaces">创建 codespaces<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9B%E5%BB%BA-codespaces" class="hash-link" aria-label="创建 codespaces的直接链接" title="创建 codespaces的直接链接">​</a></h2>
<p>codespaces 是浏览器版的 vscode，方便我们在线进行服务搭建。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化-docusaurus-项目">初始化 docusaurus 项目<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96-docusaurus-%E9%A1%B9%E7%9B%AE" class="hash-link" aria-label="初始化 docusaurus 项目的直接链接" title="初始化 docusaurus 项目的直接链接">​</a></h2>
<p>在这里，我们直接使用 codespaces 进行项目初始化。codespaces 是浏览器版的 vscode，方便我们在线进行服务搭建。</p>
<p>执行命令行：</p>
<ul>
<li><code>npx create-docusaurus@latest myblog classic</code>：初始化一个 myblog 的 docusaurus 项目</li>
<li><code>mv ./myblog/* ./myblog/.gitignore .</code>：将 myblog 目录下的所有文件移动到当前目录</li>
<li><code>rm -rf myblog</code></li>
</ul>
<p>修改 <code>docusaurus.config.js</code> 文件</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置部署公钥与密钥">配置部署公钥与密钥<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%85%8D%E7%BD%AE%E9%83%A8%E7%BD%B2%E5%85%AC%E9%92%A5%E4%B8%8E%E5%AF%86%E9%92%A5" class="hash-link" aria-label="配置部署公钥与密钥的直接链接" title="配置部署公钥与密钥的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="适配-workflow-文件">适配 workflow 文件<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%80%82%E9%85%8D-workflow-%E6%96%87%E4%BB%B6" class="hash-link" aria-label="适配 workflow 文件的直接链接" title="适配 workflow 文件的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="提交代码">提交代码<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%8F%90%E4%BA%A4%E4%BB%A3%E7%A0%81" class="hash-link" aria-label="提交代码的��直接链接" title="提交代码的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="配置-gh-pages">配置 gh-pages<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E9%85%8D%E7%BD%AE-gh-pages" class="hash-link" aria-label="配置 gh-pages的直接链接" title="配置 gh-pages的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化-action-环境">初始化 action 环境<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96-action-%E7%8E%AF%E5%A2%83" class="hash-link" aria-label="初始化 action 环境的直接链接" title="初始化 action 环境的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="新建-docusaurus-项目">新建 docusaurus 项目<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%96%B0%E5%BB%BA-docusaurus-%E9%A1%B9%E7%9B%AE" class="hash-link" aria-label="新建 docusaurus 项目的直接链接" title="新建 docusaurus 项目的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="初始化">初始化<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E5%88%9D%E5%A7%8B%E5%8C%96" class="hash-link" aria-label="初始化的直接链接" title="初始化的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="搭建-github-actions">搭建 Github Actions<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%90%AD%E5%BB%BA-github-actions" class="hash-link" aria-label="搭建 Github Actions的直接链接" title="搭建 Github Actions的直接链接">​</a></h2>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="更新仓库尝试自动部署">更新仓库，尝试自动部署<a href="https://czasg.github.io/orange-ang/blog/tutorial-docusaurus-deploy-github-pages#%E6%9B%B4%E6%96%B0%E4%BB%93%E5%BA%93%E5%B0%9D%E8%AF%95%E8%87%AA%E5%8A%A8%E9%83%A8%E7%BD%B2" class="hash-link" aria-label="更新仓库，尝试自动部署的直接链接" title="更新仓库，尝试自动部署的直接链接">​</a></h2>
<br>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>👇👇👇</div><div class="admonitionContent_BuS1"><p><strong>本文作者:</strong> 橙子昂 <br>
<strong>版权声明:</strong> 转载请注明出处哦~👮‍👮‍👮‍</p></div></div>]]></content:encoded>
            <category>撰写中</category>
            <category>教程</category>
        </item>
    </channel>
</rss>